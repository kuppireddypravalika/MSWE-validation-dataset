From 171e1e9d7240fd760e03b779897301fd28319825 Mon Sep 17 00:00:00 2001
From: Eric Wong <normalperson@yhbt.net>
Date: Sun, 26 Mar 2006 19:31:22 +0000
Subject: [PATCH] src/playlist.c: remove unnecessary strdup()

Yes, I know about what I said on IRC earlier, but this
is an allocation + free inside a loop.

git-svn-id: https://svn.musicpd.org/mpd/trunk@3953 09075e82-0dd4-0310-85a5-a0d7c8717e4f
---
 src/playlist.c | 9 +++++----
 1 file changed, 5 insertions(+), 4 deletions(-)

diff --git a/src/playlist.c b/src/playlist.c
index 2edf4cb7d9..d122948e5b 100644
--- a/src/playlist.c
+++ b/src/playlist.c
@@ -1461,12 +1461,13 @@ static int PlaylistIterFunc(FILE * fp, char * utf8file, void (*IterFunc)(FILE *f
 			slength = 0;
 			temp = fsCharsetToUtf8(s);
 			if(!temp) continue;
-			/* Needed to make a copy? */
 			if(!commentCharFound)
 			{
-				temp = strdup(temp);
-				IterFunc(fp, temp, &erroredFile);
-				free(temp);
+				/* using temp directly should be safe,
+				 * for our current IterFunction set
+				 * but just in case, we copy to s */
+				strcpy(s, temp);
+				IterFunc(fp, s, &erroredFile);
 			}
 		}
 		else if(slength==MAXPATHLEN) {
