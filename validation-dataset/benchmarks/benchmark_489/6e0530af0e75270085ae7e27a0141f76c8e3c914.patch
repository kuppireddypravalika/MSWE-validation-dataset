From 6e0530af0e75270085ae7e27a0141f76c8e3c914 Mon Sep 17 00:00:00 2001
From: Benito van der Zander <benito@benibela.de>
Date: Thu, 2 Aug 2012 10:04:22 +0000
Subject: [PATCH] reduce cpu usage during compilation

git-svn-id: svn://svn.code.sf.net/p/texstudio/code/trunk@3080 92cce386-e96d-4106-809f-596c673a3fd8
---
 buildmanager.cpp | 9 ++++++++-
 1 file changed, 8 insertions(+), 1 deletion(-)

diff --git a/buildmanager.cpp b/buildmanager.cpp
index 8dd7e862cf..8c1ec3becd 100644
--- a/buildmanager.cpp
+++ b/buildmanager.cpp
@@ -1073,10 +1073,17 @@ bool BuildManager::waitForProcess(ProcessX* p){
 	QApplication::setOverrideCursor(QCursor(Qt::WaitCursor));
 	QTime time;
 	time.start();
+	int sleepTime = 0;
 	while (p && p->isRunning()){
-		qApp->instance()->processEvents(QEventLoop::ExcludeUserInputEvents);
 		if (time.elapsed()>2000)
 			qApp->instance()->processEvents(QEventLoop::AllEvents);
+		else
+			qApp->instance()->processEvents(QEventLoop::ExcludeUserInputEvents);			
+		sleepTime++;
+		if (sleepTime > 10) { //simulate 0.1ms sleep, so it stays responsible without using 100% cpu
+			ThreadBreaker::sleep(1);
+			sleepTime = 0;
+		}
 	}
 	QApplication::restoreOverrideCursor();
 	bool result = processWaitedFor;
