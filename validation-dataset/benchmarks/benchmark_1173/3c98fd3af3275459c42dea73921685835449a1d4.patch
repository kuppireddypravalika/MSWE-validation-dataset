From 3c98fd3af3275459c42dea73921685835449a1d4 Mon Sep 17 00:00:00 2001
From: Chris Lattner <sabre@nondot.org>
Date: Sun, 22 Oct 2006 17:48:27 +0000
Subject: [PATCH] Switch to using a bitwise and instead of modulus.

llvm-svn: 39038
---
 clang/Lex/IdentifierTable.cpp | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/clang/Lex/IdentifierTable.cpp b/clang/Lex/IdentifierTable.cpp
index 92caf7c2852..f568e533170 100644
--- a/clang/Lex/IdentifierTable.cpp
+++ b/clang/Lex/IdentifierTable.cpp
@@ -125,6 +125,8 @@ struct IdentifierBucket {
 };
 
 // FIXME: start hashtablesize off at 8K entries, GROW when density gets to 3.
+/// HASH_TABLE_SIZE - The current size of the hash table.  Note that this must
+/// always be a power of two!
 static unsigned HASH_TABLE_SIZE = 8096;
 
 IdentifierTable::IdentifierTable(const LangOptions &LangOpts) {
@@ -177,7 +179,7 @@ IdentifierInfo &IdentifierTable::get(const char *NameStart,
                                      const char *NameEnd) {
   IdentifierBucket **TableArray = (IdentifierBucket**)TheTable;
 
-  unsigned Hash = HashString(NameStart, NameEnd) % HASH_TABLE_SIZE;
+  unsigned Hash = HashString(NameStart, NameEnd) & (HASH_TABLE_SIZE-1);
   unsigned Length = NameEnd-NameStart;
   
   IdentifierBucket *IdentHead = TableArray[Hash];
