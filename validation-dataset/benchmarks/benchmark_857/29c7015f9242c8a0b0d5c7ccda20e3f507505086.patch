From 29c7015f9242c8a0b0d5c7ccda20e3f507505086 Mon Sep 17 00:00:00 2001
From: Marius Pirvu <mpirvu@ca.ibm.com>
Date: Mon, 6 Feb 2017 12:36:35 -0500
Subject: [PATCH] Value Propagation performance bug fix

A feature that avoids doing VP on low frequency blocks (in order
to save compilation time) has a bug such that the JIT will not
do VP at hot/scorhing opt levels for blocks that are NOT cold.
The condition should be reversed so that the JIT avoids VP for
basic blocks that ARE cold.

Signed-off-by: Marius Pirvu <mpirvu@ca.ibm.com>
---
 compiler/optimizer/ValuePropagationCommon.cpp | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/compiler/optimizer/ValuePropagationCommon.cpp b/compiler/optimizer/ValuePropagationCommon.cpp
index e1550dee5a..2b1d76fbee 100644
--- a/compiler/optimizer/ValuePropagationCommon.cpp
+++ b/compiler/optimizer/ValuePropagationCommon.cpp
@@ -4043,7 +4043,7 @@ TR::TreeTop *TR::LocalValuePropagation::processBlock(TR::TreeTop *startTree)
       {
       if (!((((comp()->getMethodHotness() < warm)  && (_curBlock->getFrequency() > 1500)) ||
              ((comp()->getMethodHotness() == warm) && (_curBlock->getFrequency() > 500)) ||
-             ((comp()->getMethodHotness() > warm)  && (_curBlock->isCold())))))
+             ((comp()->getMethodHotness() > warm)  && (!_curBlock->isCold())))))
          {
          if (trace())
             traceMsg(comp(), "\nSkipping block_%d (low frequency)\n", _curBlock->getNumber());
