From ab2eac73495a9635e2a5bbe011e5784619916b25 Mon Sep 17 00:00:00 2001
From: "K.Ohta" <whatisthis.sowhat@gmail.com>
Date: Mon, 12 Feb 2024 17:25:34 +0900
Subject: [PATCH] [UI][Qt] Message: Use float value as frame-per-second.

---
 source/src/qt/emu_thread/emu_thread_tmpl.cpp | 8 +++++---
 1 file changed, 5 insertions(+), 3 deletions(-)

diff --git a/source/src/qt/emu_thread/emu_thread_tmpl.cpp b/source/src/qt/emu_thread/emu_thread_tmpl.cpp
index 20c336866..de839c68a 100644
--- a/source/src/qt/emu_thread/emu_thread_tmpl.cpp
+++ b/source/src/qt/emu_thread/emu_thread_tmpl.cpp
@@ -415,12 +415,14 @@ void EmuThreadClassBase::do_print_framerate(int frames)
 				dec_message_count();
 			} else {
 				int ratio;
+				double real_frames = (double)draw_frames;
+				real_frames = real_frames /  ((double)(current_time - update_fps_time + (1000 * 1000)) / 1.0e6);
 				__LIKELY_IF(p_emu != NULL) {
-					ratio = lrint(100.0 * ((double)draw_frames / (p_emu->get_frame_rate() * ((double)(current_time - update_fps_time + (1000 * 1000)) / 1.0e6))));
+					ratio = lrint(100.0 * (real_frames / p_emu->get_frame_rate()));
 				} else {
-					ratio = (int)(100.0 * ((double)draw_frames / (double)total_frames) * 2.0 + 0.5);
+					ratio = (int)(100.0 * (real_frames / (double)total_frames) * 2.0 + 0.5);
 				}
-				snprintf(buf, 255, _T("%s - %d fps (%d %%)"), get_device_name(), draw_frames, ratio);
+				snprintf(buf, 255, _T("%s - %.3ffps (%d%%)"), get_device_name(), real_frames, ratio);
 			}
 		}
 		if(p_config->romaji_to_kana) {
