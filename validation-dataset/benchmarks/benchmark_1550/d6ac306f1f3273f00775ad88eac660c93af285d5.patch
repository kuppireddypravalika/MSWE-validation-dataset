From d6ac306f1f3273f00775ad88eac660c93af285d5 Mon Sep 17 00:00:00 2001
From: "Benjamin Thomas (Aviansie Ben)" <ben@benthomas.ca>
Date: Tue, 11 Feb 2020 21:30:36 +0000
Subject: [PATCH] Disable Power arraycopy inlining for all long lengths

Previously, the arraycopy inlining on Power was disabled for lengths
exceeding 256 bytes, but only for 3-child arraycopy nodes. However, as
it turns out, our current inlining is suboptimal for long lengths. To
improve performance, this maximum length has now been applied to 5-child
arraycopy nodes as well.

Signed-off-by: Ben Thomas <ben@benthomas.ca>
---
 compiler/p/codegen/OMRTreeEvaluator.cpp | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/compiler/p/codegen/OMRTreeEvaluator.cpp b/compiler/p/codegen/OMRTreeEvaluator.cpp
index 83528b2aa5..1e8e900400 100644
--- a/compiler/p/codegen/OMRTreeEvaluator.cpp
+++ b/compiler/p/codegen/OMRTreeEvaluator.cpp
@@ -4574,7 +4574,7 @@ TR::Register *OMR::Power::TreeEvaluator::arraycopyEvaluator(TR::Node *node, TR::
       // inlineArrayCopy is not currently capable of handling very long lengths correctly. Under some circumstances, it
       // will generate an li instruction with an out-of-bounds immediate, which triggers an assert in the binary
       // encoder.
-      if (len>=0 && (!simpleCopy || len < MAX_PPC_ARRAYCOPY_INLINE) && len < 0x100000000LL)
+      if (len>=0 && len < MAX_PPC_ARRAYCOPY_INLINE)
          {
          inlineArrayCopy(node, len, srcAddrReg, dstAddrReg, cg);
          if (!simpleCopy)
