From 63b55b9a48bfa59f541adab8629d9927e040c714 Mon Sep 17 00:00:00 2001
From: Max Kellermann <max@duempel.org>
Date: Sat, 12 Apr 2008 04:11:17 +0000
Subject: [PATCH] use free()+malloc() instead of realloc()

realloc() has to copy data to the new buffer.  Since convBuffer
contains temporary data only, we can safely use free() plus a new
malloc(), which saves the mempy().

git-svn-id: https://svn.musicpd.org/mpd/trunk@7246 09075e82-0dd4-0310-85a5-a0d7c8717e4f
---
 src/outputBuffer.c | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/src/outputBuffer.c b/src/outputBuffer.c
index b478c2c524..04641faa39 100644
--- a/src/outputBuffer.c
+++ b/src/outputBuffer.c
@@ -76,7 +76,9 @@ int sendDataToOutputBuffer(OutputBuffer * cb, InputStream * inStream,
 		datalen = pcm_sizeOfConvBuffer(&(dc->audioFormat), dataInLen,
 		                               &(cb->audioFormat));
 		if (datalen > convBufferLen) {
-			convBuffer = xrealloc(convBuffer, datalen);
+			if (convBuffer != NULL)
+				free(convBuffer);
+			convBuffer = xmalloc(datalen);
 			convBufferLen = datalen;
 		}
 		data = convBuffer;
