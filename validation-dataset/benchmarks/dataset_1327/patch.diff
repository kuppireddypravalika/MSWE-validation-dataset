From 9d33cbcc7209a07dbbc058209da9e1650013d779 Mon Sep 17 00:00:00 2001
From: derselbst <tom.mbrt@googlemail.com>
Date: Fri, 3 Jan 2020 17:34:11 +0100
Subject: [PATCH] Limit loop marker search to first 16KiB

---
 src/InputLibraryWrapper/LibSNDWrapper.cpp | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/src/InputLibraryWrapper/LibSNDWrapper.cpp b/src/InputLibraryWrapper/LibSNDWrapper.cpp
index 54af0f1d..fd0336d0 100644
--- a/src/InputLibraryWrapper/LibSNDWrapper.cpp
+++ b/src/InputLibraryWrapper/LibSNDWrapper.cpp
@@ -29,7 +29,9 @@ LibSNDWrapper::LibSNDWrapper(string filename, Nullable<size_t> offset, Nullable<
 void LibSNDWrapper::init()
 {
     std::ifstream ifs(this->Filename, ios::binary);
-    std::string str((std::istreambuf_iterator<char>(ifs)), std::istreambuf_iterator<char>());
+    std::array<char, 1<<14> buf;
+    ifs.read(buf.data(), sizeof(buf));
+    std::string str(buf.data(), ifs.gcount());
     std::regex rxStart("LOOPSTART=([0-9]+)");
     std::regex rxLen("LOOPLENGTH=([0-9]+)");
 
