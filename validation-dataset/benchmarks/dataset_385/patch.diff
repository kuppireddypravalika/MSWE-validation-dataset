From 5aaea8cdc7ceac907b3cdbe265e8a2b5fe74d918 Mon Sep 17 00:00:00 2001
From: Philippe Antoine <contact@catenacyber.fr>
Date: Thu, 18 Mar 2021 12:27:41 +0100
Subject: [PATCH] chunk: consume empty lines when parsing chunk length

so as to avoid quadratic complexity
---
 htp/htp_response.c | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/htp/htp_response.c b/htp/htp_response.c
index 67e7fb31..f332467d 100644
--- a/htp/htp_response.c
+++ b/htp/htp_response.c
@@ -418,8 +418,10 @@ htp_status_t htp_connp_RES_BODY_CHUNKED_LENGTH(htp_connp_t *connp) {
             connp->out_chunked_length = htp_parse_chunked_length(data, len);
 
             // empty chunk length line, lets try to continue
-            if (connp->out_chunked_length == -1004)
+            if (connp->out_chunked_length == -1004) {
+                connp->out_current_consume_offset = connp->out_current_read_offset;
                 continue;
+            }
             if (connp->out_chunked_length < 0) {
                 // reset out_current_read_offset so htp_connp_RES_BODY_IDENTITY_STREAM_CLOSE
                 // doesn't miss the first bytes
