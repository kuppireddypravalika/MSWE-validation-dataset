From 4b39ed1e29393807e4f82f1cd594c6d989538f8c Mon Sep 17 00:00:00 2001
From: Frank Warmerdam <warmerdam@pobox.com>
Date: Thu, 9 Feb 2006 05:22:07 +0000
Subject: [PATCH] Improve memory cleanup for leak testing.

git-svn-id: https://svn.osgeo.org/gdal/trunk@9137 f0d54148-0727-0410-94bb-9a71ac55c965
---
 ogr/ogr2ogr.cpp | 10 ++++++++--
 1 file changed, 8 insertions(+), 2 deletions(-)

diff --git a/ogr/ogr2ogr.cpp b/ogr/ogr2ogr.cpp
index 8a7d186c6ece..4207755e8684 100644
--- a/ogr/ogr2ogr.cpp
+++ b/ogr/ogr2ogr.cpp
@@ -28,6 +28,9 @@
  ******************************************************************************
  *
  * $Log$
+ * Revision 1.35  2006/02/09 05:22:07  fwarmerdam
+ * Improve memory cleanup for leak testing.
+ *
  * Revision 1.34  2006/02/09 05:03:09  fwarmerdam
  * added -overwrite switch, using DeleteLayer()
  *
@@ -136,6 +139,7 @@
 #include "ogr_p.h"
 #include "cpl_conv.h"
 #include "cpl_string.h"
+#include "ogr_api.h"
 
 CPL_CVSID("$Id$");
 
@@ -549,12 +553,14 @@ int main( int nArgc, char ** papszArgv )
     delete poDS;
 
     CSLDestroy(papszSelFields);
+    CSLDestroy( papszArgv );
+    CSLDestroy( papszLayers );
+
+    OGRCleanupAll();
 
 #ifdef DBMALLOC
     malloc_dump(1);
 #endif
-
-    CSLDestroy( papszArgv );
     
     return 0;
 }
