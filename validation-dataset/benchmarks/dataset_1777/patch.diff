From 760a1f6c43305864677e61432161c373d0fcd2f4 Mon Sep 17 00:00:00 2001
From: Laurent Trinques <scorpio@qelectrotech.org>
Date: Wed, 21 Apr 2021 09:38:48 +0200
Subject: [PATCH] Try to improve HIGHDPI_SCALING

---
 sources/main.cpp | 9 ++++++++-
 1 file changed, 8 insertions(+), 1 deletion(-)

diff --git a/sources/main.cpp b/sources/main.cpp
index 365fc53f1..c266816de 100644
--- a/sources/main.cpp
+++ b/sources/main.cpp
@@ -168,13 +168,20 @@ int main(int argc, char **argv)
 	QCoreApplication::setApplicationName("QElectroTech");
 	//Creation and execution of the application
 	//HighDPI
-#if QT_VERSION < QT_VERSION_CHECK(6, 0, 0)	// ### Qt 6: remove
+#if QT_VERSION < QT_VERSION_CHECK(5, 14, 0)	// ### Qt 6: remove
 	QCoreApplication::setAttribute(Qt::AA_EnableHighDpiScaling);
 #else
 #if TODO_LIST
 #pragma message("@TODO remove code for QT 6 or later")
 #endif
 #endif
+
+#if QT_VERSION >= QT_VERSION_CHECK(5, 14, 0)
+qputenv("QT_ENABLE_HIGHDPI_SCALING", "1");
+QGuiApplication::setHighDpiScaleFactorRoundingPolicy(Qt::HighDpiScaleFactorRoundingPolicy::PassThrough);
+#endif
+
+
 	SingleApplication app(argc, argv, true);
 #ifdef Q_OS_MACOS
 	//Handle the opening of QET when user double click on a .qet .elmt .tbt file
