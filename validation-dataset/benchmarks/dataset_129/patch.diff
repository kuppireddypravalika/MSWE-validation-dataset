From ef2a39fc7be598f03f27baa30dffe31fb7833f44 Mon Sep 17 00:00:00 2001
From: Thomas Goyne <plorkyeran@aegisub.org>
Date: Sun, 9 Jun 2013 07:37:05 -0700
Subject: [PATCH] Eliminate pointless UTF-8 -> utf-8 conversion

---
 aegisub/libaegisub/include/libaegisub/line_iterator.h | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/aegisub/libaegisub/include/libaegisub/line_iterator.h b/aegisub/libaegisub/include/libaegisub/line_iterator.h
index 4388a61d3..676015dc5 100644
--- a/aegisub/libaegisub/include/libaegisub/line_iterator.h
+++ b/aegisub/libaegisub/include/libaegisub/line_iterator.h
@@ -23,6 +23,7 @@
 #include <sstream>
 
 #include <cstdint>
+#include <boost/algorithm/string/case_conv.hpp>
 
 #include <libaegisub/charset_conv.h>
 
@@ -70,14 +71,14 @@ class line_iterator : public std::iterator<std::input_iterator_tag, OutputType>
 	, lf(0)
 	, width(0)
 	{
+		boost::to_lower(encoding);
 		agi::charset::IconvWrapper c("utf-8", encoding.c_str());
 		c.Convert("\r", 1, reinterpret_cast<char *>(&cr), sizeof(int));
 		c.Convert("\n", 1, reinterpret_cast<char *>(&lf), sizeof(int));
 		width = c.RequiredBufferSize("\n");
 
-		if (encoding != "utf-8") {
+		if (encoding != "utf-8")
 			conv.reset(new agi::charset::IconvWrapper(encoding.c_str(), "utf-8"));
-		}
 		init();
 		++(*this);
 	}
