From 530c2d9009af953364d830f00675ca313b24f3e9 Mon Sep 17 00:00:00 2001
From: David Korth <gerbilsoft@gerbilsoft.com>
Date: Wed, 9 May 2018 01:27:56 -0400
Subject: [PATCH] [libromdata] GameCom: Minor optimization for image blitting
 if both strides match.

---
 src/libromdata/Handheld/GameCom.cpp | 15 ++++++++++-----
 1 file changed, 10 insertions(+), 5 deletions(-)

diff --git a/src/libromdata/Handheld/GameCom.cpp b/src/libromdata/Handheld/GameCom.cpp
index c9bc179201..aa0a121aeb 100644
--- a/src/libromdata/Handheld/GameCom.cpp
+++ b/src/libromdata/Handheld/GameCom.cpp
@@ -243,11 +243,16 @@ const rp_image *GameComPrivate::loadIcon(void)
 		pSrc = &tmpbuf[GCOM_ICON_W * iconYalign];
 		pDestBase = reinterpret_cast<uint8_t*>(icon->bits());
 		dest_stride = icon->stride();
-		// TODO: Skip the loop if the strides match?
-		for (int y = GCOM_ICON_H; y > 0; y--) {
-			memcpy(pDestBase, pSrc, GCOM_ICON_W);
-			pSrc += GCOM_ICON_W;
-			pDestBase += dest_stride;
+		if (dest_stride == GCOM_ICON_W) {
+			// Stride matches. Copy everything all at once.
+			memcpy(pDestBase, pSrc, GCOM_ICON_W*GCOM_ICON_H);
+		} else {
+			// Stride doesn't match. Copy line-by-line.
+			for (int y = GCOM_ICON_H; y > 0; y--) {
+				memcpy(pDestBase, pSrc, GCOM_ICON_W);
+				pSrc += GCOM_ICON_W;
+				pDestBase += dest_stride;
+			}
 		}
 	}
 
