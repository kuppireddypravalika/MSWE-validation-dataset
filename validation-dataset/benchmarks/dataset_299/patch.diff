From c6f33ef076f0225dbf43e832045ccdff018f7d81 Mon Sep 17 00:00:00 2001
From: Even Rouault <even.rouault@spatialys.com>
Date: Sun, 29 Apr 2018 23:00:45 +0200
Subject: [PATCH] DXF: avoid performance issue when reading INSERT. Fixes
 https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=8067. Credit to OSS
 Fuzz

---
 gdal/ogr/ogrsf_frmts/dxf/ogrdxflayer.cpp | 11 ++++++++++-
 1 file changed, 10 insertions(+), 1 deletion(-)

diff --git a/gdal/ogr/ogrsf_frmts/dxf/ogrdxflayer.cpp b/gdal/ogr/ogrsf_frmts/dxf/ogrdxflayer.cpp
index 872c7b6b0a6d..63871502e965 100644
--- a/gdal/ogr/ogrsf_frmts/dxf/ogrdxflayer.cpp
+++ b/gdal/ogr/ogrsf_frmts/dxf/ogrdxflayer.cpp
@@ -2735,7 +2735,16 @@ OGRGeometry *OGRDXFLayer::SimplifyBlockGeometry(
         {
             OGRGeometry *poGeom = poCollection->getGeometryRef(0);
             poCollection->removeGeometry(0,FALSE);
-            aosPolygons.push_back(poGeom);
+            if( !aosPolygons.empty() && aosPolygons[0]->Equals(poGeom) )
+            {
+                // Avoids a performance issue as in
+                // https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=8067
+                delete poGeom;
+            }
+            else
+            {
+                aosPolygons.push_back(poGeom);
+            }
         }
         delete poCollection;
         int bIsValidGeometry;
