From 74be92ae00ca7fca6b82aa31ae2813bb98c106bd Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Francisco=20de=20la=20Pe=C3=B1a?= <fran@fran.cr>
Date: Tue, 17 Jun 2014 11:02:22 -0600
Subject: [PATCH] ICU: free allocated memory

---
 src/reader_util.cpp | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/src/reader_util.cpp b/src/reader_util.cpp
index da714b0bc..818fd1b78 100644
--- a/src/reader_util.cpp
+++ b/src/reader_util.cpp
@@ -260,6 +260,7 @@ std::string ReaderUtil::Recode(const std::string& str_to_encode,
 	UChar* unicode_str = new UChar[size];
 	UConverter *conv;
 	int length;
+	std::string result_str;
 
 	conv = ucnv_open(encoding_str.c_str(), &status);
 	length = ucnv_toUChars(conv, unicode_str, size, str_to_encode.c_str(), -1, &status);
@@ -273,7 +274,12 @@ std::string ReaderUtil::Recode(const std::string& str_to_encode,
 	ucnv_close(conv);
 	if (status != U_ZERO_ERROR) return std::string();
 
-	return std::string(&result[0]);
+	result_str = result;
+
+	delete[] unicode_str;
+	delete[] result;
+
+	return std::string(result_str);
 #else
 #  ifdef _WIN32
 	size_t strsize = str_to_encode.size();
