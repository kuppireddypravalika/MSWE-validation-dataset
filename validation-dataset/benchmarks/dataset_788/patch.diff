From 0e4d1aef14c58902d7ff221a17b7354d2345e443 Mon Sep 17 00:00:00 2001
From: Jakob Rath <git@jakobrath.eu>
Date: Fri, 19 Feb 2021 16:47:29 +0100
Subject: [PATCH] Don't allocate too many watch lists

---
 SMTSubsumption/subsat/subsat.hpp | 8 +++++---
 1 file changed, 5 insertions(+), 3 deletions(-)

diff --git a/SMTSubsumption/subsat/subsat.hpp b/SMTSubsumption/subsat/subsat.hpp
index 8733718e3e..d0219f592f 100644
--- a/SMTSubsumption/subsat/subsat.hpp
+++ b/SMTSubsumption/subsat/subsat.hpp
@@ -87,14 +87,16 @@ class Solver
   [[nodiscard]] Var new_variable()
   {
     // TODO: optional argument phase_hint as initial value for m_phases?
+    Var new_var = Var{m_used_vars++};
     m_unassigned_vars++;
     m_vars.push_back({ .level = InvalidLevel, .reason = ClauseRef::invalid()});
     m_marks.push_back(0);
     m_values.push_back(Value::Unassigned); // value of positive literal
     m_values.push_back(Value::Unassigned); // value of negative literal
-    m_watches.emplace_back().reserve(16);  // positive literal watches
-    m_watches.emplace_back().reserve(16);  // negative literal watches
-    return Var{m_used_vars++};
+    while (m_watches.size() < 2 * m_used_vars) {
+      m_watches.emplace_back().reserve(16);
+    }
+    return new_var;
   }
 
   /// Reserve space for 'count' variables (in total),
