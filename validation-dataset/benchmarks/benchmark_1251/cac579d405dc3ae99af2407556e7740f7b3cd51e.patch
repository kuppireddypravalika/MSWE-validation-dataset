From cac579d405dc3ae99af2407556e7740f7b3cd51e Mon Sep 17 00:00:00 2001
From: John Criswell <criswell@uiuc.edu>
Date: Fri, 29 Oct 2010 16:02:42 +0000
Subject: [PATCH] Do not add a DSNode to a DenseSet before trying to find
 DSNodes reachable from it; this causes DSNode::markReachableNodes() to think
 it has visited the root DSNode, and it never does the reachablility search.
 This change fixes em3d and other programs which suffered pool mismatch errors
 caused by poolalloc creating a local pool for a pool that was passed in.

git-svn-id: https://llvm.org/svn/llvm-project/poolalloc/trunk@117654 91177308-0d34-0410-b5e6-96231b3b80d8
---
 lib/PoolAllocate/PoolAllocate.cpp | 1 -
 1 file changed, 1 deletion(-)

diff --git a/lib/PoolAllocate/PoolAllocate.cpp b/lib/PoolAllocate/PoolAllocate.cpp
index 2a973f12..3202c171 100644
--- a/lib/PoolAllocate/PoolAllocate.cpp
+++ b/lib/PoolAllocate/PoolAllocate.cpp
@@ -752,7 +752,6 @@ PoolAllocate::FindFunctionPoolArgs (const std::vector<const Function *> & Functi
   DenseSet<const DSNode*> MarkedNodes;
   for (unsigned index = 0; index < RootNodes.size(); ++index) {
     if (DSNode * N = RootNodes[index].getNode()) {
-      MarkedNodes.insert (N);
       N->markReachableNodes(MarkedNodes);
     }
   }
