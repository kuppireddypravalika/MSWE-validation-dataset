From e898068fe5ee39fc74853afde76afb926cd12bad Mon Sep 17 00:00:00 2001
From: Guido Tack <tack@gecode.org>
Date: Mon, 21 Jun 2010 09:42:26 +0000
Subject: [PATCH] Fix optimized posting of non-linear expressions (wouldn't
 work with relations other than ==)

git-svn-id: file:///Users/tack/GecodeGitMigration/gecode-svn-mirror/gecode/trunk@11090 e85b7adc-8362-4630-8c63-7469d557c915
---
 gecode/minimodel/lin-expr.hpp | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/gecode/minimodel/lin-expr.hpp b/gecode/minimodel/lin-expr.hpp
index 5d86df1918..e559747287 100755
--- a/gecode/minimodel/lin-expr.hpp
+++ b/gecode/minimodel/lin-expr.hpp
@@ -267,11 +267,13 @@ namespace Gecode {
         default: break;
         }
         n->r->sum.ne->post(home,irt,n->c,icl);
-      } else if (n->t==NT_SUB && n->r->t==NT_NONLIN &&
+      } else if (irt==IRT_EQ &&
+                 n->t==NT_SUB && n->r->t==NT_NONLIN &&
                  n->l != NULL && n->l->t==NT_VAR_INT
                  && n->l->a==1) {
         (void) n->r->sum.ne->post(home,&n->l->x_int,icl);
-      } else if (n->t==NT_SUB && n->r->t==NT_VAR_INT &&
+      } else if (irt==IRT_EQ &&
+                 n->t==NT_SUB && n->r->t==NT_VAR_INT &&
                  n->l != NULL && n->l->t==NT_NONLIN
                  && n->r->a==1) {
         (void) n->l->sum.ne->post(home,&n->r->x_int,icl);
