From d9c0c465ef7c02ead47add81a90ecdb8a12a83b3 Mon Sep 17 00:00:00 2001
From: Piotr Sobczak <Piotr.Sobczak@amd.com>
Date: Tue, 17 Nov 2020 17:26:43 +0100
Subject: [PATCH] More aggressive speculative execution

Increase the threshold of max speculation cost from 7 to 10.

This option drives speculative-execution LLVM pass.

More aggressive threshold (together with D91633) gives measurable
improvements in one game, with no regressions found elsewhere.
---
 lgc/state/LgcContext.cpp | 1 +
 1 file changed, 1 insertion(+)

diff --git a/lgc/state/LgcContext.cpp b/lgc/state/LgcContext.cpp
index 4cbbe482c7..93a62adcf8 100644
--- a/lgc/state/LgcContext.cpp
+++ b/lgc/state/LgcContext.cpp
@@ -158,6 +158,7 @@ void LgcContext::initialize() {
   setOptionDefault("amdgpu-atomic-optimizations", "1");
   setOptionDefault("use-gpu-divergence-analysis", "1");
   setOptionDefault("structurizecfg-skip-uniform-regions", "1");
+  setOptionDefault("spec-exec-max-speculation-cost", "10");
 #if !defined(LLVM_HAVE_BRANCH_AMD_GFX)
 #warning[!amd-gfx] Conditional discard transformations not supported
 #else
