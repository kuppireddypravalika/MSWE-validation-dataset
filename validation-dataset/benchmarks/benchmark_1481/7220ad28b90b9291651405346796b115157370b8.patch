From 7220ad28b90b9291651405346796b115157370b8 Mon Sep 17 00:00:00 2001
From: tteuling <tteuling@users.sourceforge.net>
Date: Mon, 18 Jun 2012 19:28:15 +0200
Subject: [PATCH] Use x*x instead of pow(x,2), making it easier for the
 compiler to optimize this (Thanks Niels).

---
 libosmscout/src/osmscout/util/Transformation.cpp | 9 +++++----
 1 file changed, 5 insertions(+), 4 deletions(-)

diff --git a/libosmscout/src/osmscout/util/Transformation.cpp b/libosmscout/src/osmscout/util/Transformation.cpp
index 0376b7bb1..c7f920de0 100644
--- a/libosmscout/src/osmscout/util/Transformation.cpp
+++ b/libosmscout/src/osmscout/util/Transformation.cpp
@@ -39,17 +39,15 @@ namespace osmscout {
       return std::numeric_limits<double>::infinity();
     }
 
-    double u=((p.x-a.x)*xdelta+(p.y-a.y)*ydelta)/(pow(xdelta,2)+pow(ydelta,2));
+    double u=((p.x-a.x)*xdelta+(p.y-a.y)*ydelta)/(xdelta*xdelta+ydelta*ydelta);
 
     double cx,cy;
 
     if (u<0) {
-      u=0;
       cx=a.x;
       cy=a.y;
     }
     else if (u>1) {
-      u=1;
       cx=b.x;
       cy=b.y;
     }
@@ -58,7 +56,10 @@ namespace osmscout {
       cy=a.y+u*ydelta;
     }
 
-    return sqrt(pow(cx-p.x,2)+pow(cy-p.y,2));
+    double dx = cx-p.x;
+    double dy = cy-p.y;
+
+    return sqrt(dx*dx+dy*dy);
   }
 
   TransPolygon::TransPolygon()
