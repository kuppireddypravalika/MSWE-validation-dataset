From 891c0939c752bce7df2b7de9b992287fa537d38d Mon Sep 17 00:00:00 2001
From: tteuling <tteuling@users.sourceforge.net>
Date: Sun, 24 Mar 2013 08:30:42 +0100
Subject: [PATCH] Use more projection methods  instead of doing the whole scale
 calculation on our own.

---
 TravelJinni/src/Viewer.cpp | 7 ++-----
 1 file changed, 2 insertions(+), 5 deletions(-)

diff --git a/TravelJinni/src/Viewer.cpp b/TravelJinni/src/Viewer.cpp
index 183a4f7ca..20f7a2793 100644
--- a/TravelJinni/src/Viewer.cpp
+++ b/TravelJinni/src/Viewer.cpp
@@ -146,16 +146,13 @@ class MapControl : public Lum::Object
 
     projection.GetDimensions(lonMin,latMin,lonMax,latMax);
 
-    double d=(lonMax-lonMin)*2*M_PI/360;
     double scaleSize;
     size_t minScaleWidth=width/20;
     size_t maxScaleWidth=width/10;
-    double scaleValue=d*180*60/M_PI*1852.216/(width/minScaleWidth);
-
-    //std::cout << "1/10 screen (" << width/10 << " pixels) are: " << scaleValue << " meters" << std::endl;
+    double scaleValue=projection.GetPixelSize()*minScaleWidth;
 
     scaleValue=pow(10,floor(log10(scaleValue))+1);
-    scaleSize=scaleValue/(d*180*60/M_PI*1852.216/width);
+    scaleSize=scaleValue/projection.GetPixelSize();
 
     if (scaleSize>minScaleWidth && scaleSize/2>minScaleWidth && scaleSize/2<=maxScaleWidth) {
       scaleValue=scaleValue/2;
