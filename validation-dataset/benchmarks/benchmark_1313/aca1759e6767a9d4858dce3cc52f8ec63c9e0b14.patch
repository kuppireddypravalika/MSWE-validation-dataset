From aca1759e6767a9d4858dce3cc52f8ec63c9e0b14 Mon Sep 17 00:00:00 2001
From: Sainan <sainan@calamity.gg>
Date: Fri, 7 Apr 2023 07:54:57 +0200
Subject: [PATCH] Also do single field destructuring optimisation for
 non-rvalue tables

---
 src/lparser.cpp | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/src/lparser.cpp b/src/lparser.cpp
index a2ebf7db0..e91443791 100644
--- a/src/lparser.cpp
+++ b/src/lparser.cpp
@@ -3767,7 +3767,8 @@ static void destructuring (LexState *ls) {
   expr(ls, &t);
 
   /* special case for destructuring a single field only, can be done in-place */
-  if (t.k == VNONRELOC && props.size() == 1) {
+  if (props.size() == 1) {
+    luaK_exp2nextreg(ls->fs, &t);
     expdesc k, l;
     codestring(&k, props.at(0));
     luaK_indexed(ls->fs, &t, &k);
