From 1ff6bbfa55ad422a000bb8ec28783720d812942f Mon Sep 17 00:00:00 2001
From: Kavon Farvardin <kavon@farvard.in>
Date: Thu, 23 Aug 2018 15:34:35 -0500
Subject: [PATCH] run polly's canonicalization passes before the main ones

---
 runtime/tuner/Optimizer.cpp | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/runtime/tuner/Optimizer.cpp b/runtime/tuner/Optimizer.cpp
index a2de346..9f5286b 100644
--- a/runtime/tuner/Optimizer.cpp
+++ b/runtime/tuner/Optimizer.cpp
@@ -20,6 +20,7 @@
 
 #ifdef POLLY_KNOBS
   #include <polly/RegisterPasses.h>
+  #include <polly/Canonicalization.h>
 #endif
 
 namespace {
@@ -78,6 +79,7 @@ namespace tuner {
     // Before the main optimizations, we want to run Polly
     Builder.addExtension(llvm::PassManagerBuilder::EP_ModuleOptimizerEarly,
         [=] (auto const& Builder, auto &PM) {
+          polly::registerCanonicalicationPasses(PM);
           polly::registerPollyPasses(PM);
         });
 #endif
