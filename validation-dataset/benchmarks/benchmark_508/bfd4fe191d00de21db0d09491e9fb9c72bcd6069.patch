From bfd4fe191d00de21db0d09491e9fb9c72bcd6069 Mon Sep 17 00:00:00 2001
From: Andreas Gal <gal@mozilla.com>
Date: Fri, 28 Nov 2008 17:31:17 -0800
Subject: [PATCH] Abort compilation of a regular expression if we run out of
 memory during recording (466588, r=danderson).

---
 js/src/jsregexp.cpp | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/js/src/jsregexp.cpp b/js/src/jsregexp.cpp
index 7b4d2d6258f..402f30a2189 100644
--- a/js/src/jsregexp.cpp
+++ b/js/src/jsregexp.cpp
@@ -2327,6 +2327,8 @@ class RegExpNativeCompiler {
 
         guard = insertGuard(re_chars, re_length);
 
+        if (lirbuf->outOmem()) 
+            goto fail;
         ::compile(fragmento->assm(), fragment);
         if (fragmento->assm()->error() != nanojit::None) {
             oom = fragmento->assm()->error() == nanojit::OutOMem;
