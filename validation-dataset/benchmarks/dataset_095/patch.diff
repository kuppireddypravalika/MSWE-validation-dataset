From cb6cf8a7631601ca47f25577e03e43a9627d3b81 Mon Sep 17 00:00:00 2001
From: Ravbug <ravbuganimations@gmail.com>
Date: Sat, 18 Dec 2021 21:48:40 -0800
Subject: [PATCH] Efficiency improvement - sleep if safe to do so

---
 src/App.cpp | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/src/App.cpp b/src/App.cpp
index 0a9276bb9..a0c9c14f4 100644
--- a/src/App.cpp
+++ b/src/App.cpp
@@ -204,6 +204,11 @@ int App::run(int argc, char** argv) {
 		do{
 			auto workEnd = clocktype::now();
 			work_time = workEnd - now;
+			auto delta = min_tick_time - work_time;
+			if (delta > std::chrono::duration<double, std::milli>(3)) {
+				auto dc = std::chrono::duration_cast<std::chrono::milliseconds>(delta);
+				std::this_thread::sleep_for(std::chrono::duration<double, std::milli>(std::max(dc.count()-1,0ll)));
+			}
 		}while (work_time < min_tick_time);
         
 		lastFrameTime = now;
