From 00ac2f834b716095cd4585b4dbc7e06c100728fd Mon Sep 17 00:00:00 2001
From: turleypol <turley@polserver.com>
Date: Wed, 20 Dec 2017 22:21:49 +0100
Subject: [PATCH] Found the next easy bottleneck during method call.

---
 pol-core/bscript/executor.cpp | 10 +++-------
 1 file changed, 3 insertions(+), 7 deletions(-)

diff --git a/pol-core/bscript/executor.cpp b/pol-core/bscript/executor.cpp
index 5edf120a17..c9cc49fccb 100644
--- a/pol-core/bscript/executor.cpp
+++ b/pol-core/bscript/executor.cpp
@@ -3488,9 +3488,9 @@ void Executor::initForFnCall( unsigned in_PC )
   done = 0;
   seterror( false );
 
+#ifdef MEMORYLEAK
   while ( !ValueStack.empty() )
   {
-#ifdef MEMORYLEAK
     if ( Clib::memoryleak_debug )
     {
       if ( !data_shown )
@@ -3502,19 +3502,15 @@ void Executor::initForFnCall( unsigned in_PC )
       LEAKLOG << ValueStack.back()->impptr()->pack();
       LEAKLOG << " [" << ValueStack.back()->impptr()->sizeEstimate() << "] ";
     }
-#endif
-
     ValueStack.pop_back();
   }
-
-#ifdef MEMORYLEAK
   if ( Clib::memoryleak_debug )
     if ( data_shown )
       LEAKLOG << " ...deleted\n";
 #endif
 
-  delete Locals2;
-  Locals2 = new BObjectRefVec;
+  ValueStack.clear();
+  Locals2->clear();
 }
 
 void Executor::pushArg( BObjectImp* arg )
