From c9b4e5f71f47962bb2d504370731f0d88dab1188 Mon Sep 17 00:00:00 2001
From: "bernard.parisse" <bernard.parisse@23ce0884-8a58-47d3-bc5c-ddf1cd5b9f9e>
Date: Mon, 15 Jun 2015 13:35:13 +0000
Subject: [PATCH] [giac] attempt to improve fsolve, see #5252

git-svn-id: https://dev.geogebra.org/svn/trunk/geogebra/giac@41169 23ce0884-8a58-47d3-bc5c-ddf1cd5b9f9e
---
 src/giac/cpp/solve.cc | 9 ++++++---
 1 file changed, 6 insertions(+), 3 deletions(-)

diff --git a/src/giac/cpp/solve.cc b/src/giac/cpp/solve.cc
index 040511a5..8157e6b4 100644
--- a/src/giac/cpp/solve.cc
+++ b/src/giac/cpp/solve.cc
@@ -2515,9 +2515,11 @@ namespace giac {
 	  break;
 	if (onlyone)
 	  return vecteur(1,a);
-	res.push_back(a);
+	if (is_exactly_zero(a))
+	  res.push_back(a);
 	a +=decal;
       }
+      fb=fa;
       for (;is_strictly_greater(b,a,contextptr);){
 	fb=subst(equation,var,b,false,contextptr);
 	fb=eval(fb,1,contextptr);
@@ -2525,7 +2527,8 @@ namespace giac {
 	  break;
 	if (onlyone)
 	  return vecteur(1,b);
-	res.push_back(b);
+	if (is_exactly_zero(b))
+	  res.push_back(b);
 	b -=decal;
       }
 #ifndef NO_STDEXCEPT
@@ -2536,7 +2539,7 @@ namespace giac {
 #endif
     int ntries=40;
     gen ab=(b-a)/ntries;
-    if (fb.type!=_DOUBLE_){      
+    if (fb.type!=_DOUBLE_ || is_undef(fb)){      
       for (int i=0;i<ntries;++i){
 	b -= ab;
 	fb=subst(equation,var,b,false,contextptr);
