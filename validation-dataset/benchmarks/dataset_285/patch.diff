From 3a6917aa052fcb2a2f1a02f3a50a489fe52dfd75 Mon Sep 17 00:00:00 2001
From: Even Rouault <even.rouault@mines-paris.org>
Date: Tue, 27 Feb 2018 11:49:45 +0000
Subject: [PATCH] openfilegdb: make IsLikelyFeatureAtOffset() return faster in
 case of non-match. Fixes
 https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=6567. Credit to OSS
 Fuzz

git-svn-id: https://svn.osgeo.org/gdal/trunk@41567 f0d54148-0727-0410-94bb-9a71ac55c965
---
 gdal/ogr/ogrsf_frmts/openfilegdb/filegdbtable.cpp | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/gdal/ogr/ogrsf_frmts/openfilegdb/filegdbtable.cpp b/gdal/ogr/ogrsf_frmts/openfilegdb/filegdbtable.cpp
index 9e3b63d280b7..28ed1b3fb08c 100644
--- a/gdal/ogr/ogrsf_frmts/openfilegdb/filegdbtable.cpp
+++ b/gdal/ogr/ogrsf_frmts/openfilegdb/filegdbtable.cpp
@@ -412,11 +412,11 @@ int FileGDBTable::IsLikelyFeatureAtOffset(vsi_l_offset nOffset,
                 CPLAssert(false);
                 break;
         }
+        if( nRowBlobLength < nRequiredLength )
+            return FALSE;
     }
     if( !bExactSizeKnown )
     {
-        if( nRowBlobLength < nRequiredLength )
-            return FALSE;
         if( VSIFReadL(pabyBuffer + nNullableFieldsSizeInBytes,
                 nRowBlobLength - nNullableFieldsSizeInBytes, 1, fpTable) != 1 )
             return FALSE;
