From dae80ceffa48898eded610232c12df6fca2e7280 Mon Sep 17 00:00:00 2001
From: Even Rouault <even.rouault@mines-paris.org>
Date: Mon, 12 Mar 2018 12:37:57 +0000
Subject: [PATCH] ISCE: avoid excessive memory allocation attempt. Fixes
 https://oss-fuzz.com/v2/testcase-detail/6460005235556352. Credit to OSS Fuzz

git-svn-id: https://svn.osgeo.org/gdal/trunk@41746 f0d54148-0727-0410-94bb-9a71ac55c965
---
 gdal/frmts/raw/iscedataset.cpp | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/gdal/frmts/raw/iscedataset.cpp b/gdal/frmts/raw/iscedataset.cpp
index 40c1c837f75a..ea269de96ae6 100644
--- a/gdal/frmts/raw/iscedataset.cpp
+++ b/gdal/frmts/raw/iscedataset.cpp
@@ -712,6 +712,16 @@ GDALDataset *ISCEDataset::Open( GDALOpenInfo *poOpenInfo )
         return nullptr;
     }
 
+    if( !RAWDatasetCheckMemoryUsage(
+                        poDS->nRasterXSize, poDS->nRasterYSize, nBands,
+                        nPixelOffset, nLineOffset, 0, nBandOffset,
+                        poDS->fpImage) )
+    {
+        delete poDS;
+        CSLDestroy( papszXmlProps );
+        return nullptr;
+    }
+
     poDS->nBands = nBands;
     for (int b = 0; b < nBands; b++)
     {
