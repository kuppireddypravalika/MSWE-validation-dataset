From 4c5ad730172d8422eabba194a0969a91231e4d62 Mon Sep 17 00:00:00 2001
From: Alpha <alpha@codeblocks.org>
Date: Mon, 28 Jul 2014 23:11:46 +0000
Subject: [PATCH] * compiler: rate limit build message column auto fit
 frequency to reduce excessive overhead when builds produce thousands of
 messages

git-svn-id: https://svn.code.sf.net/p/codeblocks/code/trunk@9852 2a5c6006-c6dd-42ca-98ab-0921f2732cef
---
 src/plugins/compilergcc/compilergcc.cpp | 11 ++++++++++-
 1 file changed, 10 insertions(+), 1 deletion(-)

diff --git a/src/plugins/compilergcc/compilergcc.cpp b/src/plugins/compilergcc/compilergcc.cpp
index 3e82e3becd..c8503bdbb3 100644
--- a/src/plugins/compilergcc/compilergcc.cpp
+++ b/src/plugins/compilergcc/compilergcc.cpp
@@ -3467,7 +3467,16 @@ void CompilerGCC::LogWarningOrError(CompilerLineType lt, cbProject* prj, const w
     Logger::level lv = (lt == cltError)   ? Logger::error
                      : (lt == cltWarning) ? Logger::warning : Logger::info;
 
-    m_pListLog->Append(errors, lv, 2);
+    // when there are many lines (thousands) of output, auto fitting column width
+    // is very expensive, so rate limit it to a maximum of 1 fit per 3 seconds
+    static wxDateTime lastAutofitTime = wxDefaultDateTime;
+    if ( lastAutofitTime < (wxDateTime::Now() - wxTimeSpan::Seconds(3)) )
+    {
+        lastAutofitTime = wxDateTime::Now();
+        m_pListLog->Append(errors, lv, 2); // auto fit the 'Message' column
+    }
+    else
+        m_pListLog->Append(errors, lv);
 
     // add to error keeping struct
     m_Errors.AddError(lt, prj, filename, line.IsEmpty() ? 0 : atoi(wxSafeConvertWX2MB(line)), msg);
