From 42b8e518ca7c412c5e897c88c0efc12427deb429 Mon Sep 17 00:00:00 2001
From: Jeff Epler <jepler@unpythonic.net>
Date: Sat, 24 Dec 2011 10:25:48 -0600
Subject: [PATCH] motion: remove useless call to ceil()

This call was useless, and reportedly causes some unspecified older
compilers to encounter internal compiler errors.  Others may warn
about the implicit conversion from int to double (as this makes the
code incompatible with pre-ANSI C compilers, something we all care
deeply about).

The original change may have intended to be something more like
    ceil((double)traj_period_nsec / nsec)
but since all we really care about is that the servo multiplier is
an exact integer, it's preferable to preserve the existing behavior
and just remove the useless function call.
---
 src/emc/motion/motion.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/emc/motion/motion.c b/src/emc/motion/motion.c
index 832ef6251..1222b5be1 100644
--- a/src/emc/motion/motion.c
+++ b/src/emc/motion/motion.c
@@ -1115,7 +1115,7 @@ static int init_threads(void)
 
 void emcmotSetCycleTime(unsigned long nsec ) {
     int servo_mult;
-    servo_mult = ceil(traj_period_nsec / nsec);
+    servo_mult = traj_period_nsec / nsec;
     if(servo_mult < 0) servo_mult = 1;
     setTrajCycleTime(nsec * 1e-9);
     setServoCycleTime(nsec * servo_mult * 1e-9);
