From bbe70b3518ebe2ea3d995cf7132ba85235d323da Mon Sep 17 00:00:00 2001
From: pfmark <mark.h.pfeiffer@gmail.com>
Date: Mon, 24 Aug 2015 16:04:11 +0200
Subject: [PATCH] performance issues with powers

---
 aslam_backend_expressions/src/ScalarExpressionNode.cpp | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/aslam_backend_expressions/src/ScalarExpressionNode.cpp b/aslam_backend_expressions/src/ScalarExpressionNode.cpp
index 86c501d5..e30f1277 100644
--- a/aslam_backend_expressions/src/ScalarExpressionNode.cpp
+++ b/aslam_backend_expressions/src/ScalarExpressionNode.cpp
@@ -430,7 +430,9 @@ namespace aslam {
             Eigen::Matrix<double, 1, 1> R(1,1);
             if (pow((1-arg),4) < std::numeric_limits<double>::min())   // series expansion at x = 1
             {
-                R(0,0) = -2.0 + 2.0/3.0*(arg-1.0) - 4.0/15.0*(arg-1.0)*(arg-1.0) + 4.0/35.0*(arg-1.0)*(arg-1.0)*(arg-1.0);
+                auto pow1 = arg - 1.0;
+                auto pow2 = pow1 * pow1;
+                R(0,0) = -2.0 + 2.0/3.0*pow1 - 4.0/15.0*pow2 + 4.0/35.0*pow1*pow2;
             }
             else
             {
