From 7be48fa68b56405b50fd2b926672739ebb38d45f Mon Sep 17 00:00:00 2001
From: Pilow <pierre.laupretre@gmail.com>
Date: Sat, 29 Jul 2017 11:07:06 +0200
Subject: [PATCH] [expression] Use a insn_store directly in case of var = value

---
 src/compiler/value/Expression.cpp | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

diff --git a/src/compiler/value/Expression.cpp b/src/compiler/value/Expression.cpp
index a1f11682..6c4e9269 100644
--- a/src/compiler/value/Expression.cpp
+++ b/src/compiler/value/Expression.cpp
@@ -611,8 +611,13 @@ Compiler::value Expression::compile(Compiler& c) const {
 						return r;
 					}
 				} else {
-					auto v1_addr = ((LeftValue*) v1)->compile_l(c);
-					c.insn_store_relative(v1_addr, 0, y);
+					if (dynamic_cast<VariableValue*>(v1)) {
+						auto x = v1->compile(c);
+						c.insn_store(x, y);
+					} else {
+						auto v1_addr = ((LeftValue*) v1)->compile_l(c);
+						c.insn_store_relative(v1_addr, 0, y);
+					}
 					if (type.nature == Nature::POINTER) {
 						return c.insn_to_pointer(y);
 					}
