From 219fa9d816036b0b11951f478e3b0f02ba0aeedf Mon Sep 17 00:00:00 2001
From: crazySocket <michal.pletty@gmail.com>
Date: Tue, 1 Jul 2014 23:02:55 +0200
Subject: [PATCH] matrix inverse without arma::inv

---
 src/cec/cecModule.cpp | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/src/cec/cecModule.cpp b/src/cec/cecModule.cpp
index 9ad9285d..cd0ae6b9 100644
--- a/src/cec/cecModule.cpp
+++ b/src/cec/cecModule.cpp
@@ -275,7 +275,13 @@ namespace gmum {
 						       cec->getPoints());
 	arma::rowvec mean = cec->clusters[i]->getMean();
 	double constMultiplier = sqrt(1.0/(pow(2*M_PI, x.n_cols)*arma::det(covMat)));
-	double scalar = arma::as_scalar((x-mean)*arma::inv(covMat)*((x-mean).t()));
+
+	arma::mat Q,R;
+	arma::qr_econ(Q,R,covMat);
+	int dim = mean.n_cols;
+	arma::mat Id = arma::eye(dim,dim);
+	arma::mat inv = solve(R,Id)*Q.t();
+	double scalar = arma::as_scalar((x-mean)*inv*((x-mean).t()));
 	double exponens = exp(-0.5*scalar);
 
 	out.push_back(constMultiplier*exponens);
