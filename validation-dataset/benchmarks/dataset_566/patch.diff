From 66f266d171b0366d48c4f783cf655390e2129a20 Mon Sep 17 00:00:00 2001
From: Kuba Ober <kuba@bertec.com>
Date: Mon, 6 Jul 2020 13:58:51 -0400
Subject: [PATCH] Don't copy face name just to hash it.

This was eating some cycles.
---
 src/FontCache.cpp | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/src/FontCache.cpp b/src/FontCache.cpp
index 7d8ab7d307..0fd4e3b37f 100644
--- a/src/FontCache.cpp
+++ b/src/FontCache.cpp
@@ -21,6 +21,7 @@
 
 #include "FontCache.h"
 #include <wx/log.h>
+#include <wx/hashmap.h>
 #include <cmath>
 #include <functional>
 #include <string>
@@ -202,7 +203,11 @@ std::size_t hash<wxFontInfo>::operator()(const wxFontInfo &fi) const
   std::size_t h = 0;
   h = mixHash(h, fi.GetEncoding());
   h = mixHash(h, fi.GetFamily());
-  h = mixHash(h, std::string(fi.GetFaceName().mb_str()));
+#ifdef wxNEEDS_WX_HASH_MAP
+  h = mixHash(h, wxStringHash()(fi.GetFaceName()));
+#else
+  h = mixHash(h, fi.GetFaceName());
+#endif
   h = mixHash(h, fi.GetStyle());
 #if wxCHECK_VERSION(3, 1, 2)
   h = mixHash(h, fi.GetNumericWeight());
