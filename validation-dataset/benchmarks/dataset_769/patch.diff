From 5230c9ba609fb83bec56a70889868052e3c15712 Mon Sep 17 00:00:00 2001
From: fuzzelhjb <chschmidt9@gmail.com>
Date: Thu, 28 Nov 2013 20:22:31 +0000
Subject: [PATCH] performance fix. update rectangle calculation added from
 rev746.

git-svn-id: https://svn.code.sf.net/p/vpinball/code/trunk@751 14438d79-0ffd-4333-8ae7-ea2bdd901387
---
 pin/collideex.cpp | 23 +++++++++++++++--------
 1 file changed, 15 insertions(+), 8 deletions(-)

diff --git a/pin/collideex.cpp b/pin/collideex.cpp
index 36d56d83b7..42ca3e8a49 100644
--- a/pin/collideex.cpp
+++ b/pin/collideex.cpp
@@ -21,15 +21,22 @@ void HitPrimitive::Collide(Ball * const pball, Vertex3Ds * const phitnormal) //!
 void PrimitiveAnimObject::Check3D()
 {
 	Primitive * const p = m_pprimitive;
-	if(!p->m_d.m_TopVisible && !p->m_d.wasVisible)
-		return;
-
-	p->m_d.wasVisible = false;
-
-	m_fInvalid = true;
+   Pin3D * const ppin3d = &g_pplayer->m_pin3d;
+   // rcBounds must be initialized here otherwise the whole screen is updated
+   ppin3d->ClearExtents(&m_rcBounds, NULL, NULL);
+   if ( !p->m_d.staticRendering )
+   {
+      if ( p->m_d.m_TopVisible )
+      {
+         memcpy( &m_rcBounds, &p->m_d.boundRectangle, sizeof(RECT));
+      }
+      else if ( p->m_d.wasVisible )
+      {
+         memcpy( &m_rcBounds, &p->m_d.boundRectangle, sizeof(RECT));
+         p->m_d.wasVisible=false;
+      }
+   }
 
-	// Seems like for now we can simply abuse the already calculated coordinates
-    memcpy( &m_rcBounds, &p->m_d.boundRectangle, sizeof(RECT));
 }
 
 void HitPrimitive::CalcHitRect()
