From 3830eb4967002715ed7b71e3e4536ae45fce83c1 Mon Sep 17 00:00:00 2001
From: Austin Clements <amdragon@mit.edu>
Date: Thu, 31 Jan 2013 21:09:35 -0500
Subject: [PATCH] perf: Support Intel CPU clocks event

---
 bin/perf.cc | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/bin/perf.cc b/bin/perf.cc
index 3e3c8fcb8..8569043d4 100644
--- a/bin/perf.cc
+++ b/bin/perf.cc
@@ -3,6 +3,7 @@
 #include <fcntl.h>
 #include "sampler.h"
 
+#if defined(HW_josmp) || defined(HW_tom)
 static u64 selector = 
   0UL << 32 |
   1 << 24 | 
@@ -12,6 +13,11 @@ static u64 selector =
   1 << 16 | 
   0x00 << 8 | 
   0x76;
+#elif defined(HW_ben) || defined(HW_ud1)
+static u64 selector = (0x3003c | (1<<20) | (1<<22));
+#else
+static u64 selector = 0;
+#endif
 static u64 period = 100000;
 
 static void
@@ -31,6 +37,9 @@ conf(int fd, sampop_t op)
 int
 main(int ac, const char *av[])
 {
+  if (selector == 0)
+    die("perf: unknown hardware");
+
   int fd = open("/dev/sampler", O_RDWR);
   if (fd < 0)
     die("perf: open failed");
