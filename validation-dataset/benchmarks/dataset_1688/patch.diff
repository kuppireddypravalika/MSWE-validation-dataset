From 37f0691b103173cb8db3e1703ffaf278f57e5394 Mon Sep 17 00:00:00 2001
From: turleypol <turley@polserver.com>
Date: Fri, 6 Sep 2019 21:02:14 +0200
Subject: [PATCH] optimzied a bit ascii speech handling

---
 pol-core/pol/speech.cpp | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/pol-core/pol/speech.cpp b/pol-core/pol/speech.cpp
index f14cd4de41..13477c68aa 100644
--- a/pol-core/pol/speech.cpp
+++ b/pol-core/pol/speech.cpp
@@ -178,13 +178,14 @@ void SpeechHandler( Network::Client* client, PKTIN_03* mymsg )
 {
   int intextlen = cfBEu16( mymsg->msglen ) - offsetof( PKTIN_03, text ) - 1;
 
-  // Preprocess the text into a sanity-checked, printable, null-terminated form in textbuf
+  // Preprocess the text into a sanity-checked, printable form in text
   if ( intextlen < 0 )
     intextlen = 0;
   if ( intextlen > SPEECH_MAX_LEN )
     intextlen = SPEECH_MAX_LEN;  // ENHANCE: May want to log this
 
   std::string text;
+  text.reserve( intextlen );
   for ( int i = 0; i < intextlen; i++ )
   {
     char ch = mymsg->text[i];
