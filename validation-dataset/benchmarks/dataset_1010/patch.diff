From 9ce7f81e3fca287d2fc41aba24893dbcd433b830 Mon Sep 17 00:00:00 2001
From: Denis Corbin <dar.linux@free.fr>
Date: Fri, 29 Aug 2014 21:54:25 +0200
Subject: [PATCH] optimization avoiding copying buffer for messaging_decode
 when type is plain data

---
 src/libdar/messaging.cpp | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/src/libdar/messaging.cpp b/src/libdar/messaging.cpp
index 438db456a..dfef303ee 100644
--- a/src/libdar/messaging.cpp
+++ b/src/libdar/messaging.cpp
@@ -357,8 +357,11 @@ namespace libdar
 		msgt = tmp;
 	}
 
-	buffer.skip_to_eof();
-	buffer.write(x_input + 1, size - 1);
+	if(msgt != msg_type::data)
+	{
+	    buffer.skip_to_eof();
+	    buffer.write(x_input + 1, size - 1);
+	}
 
 	return !msg_continues(msgt);
     }
