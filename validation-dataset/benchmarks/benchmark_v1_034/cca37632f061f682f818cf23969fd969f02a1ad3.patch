From cca37632f061f682f818cf23969fd969f02a1ad3 Mon Sep 17 00:00:00 2001
From: Will Dietz <wdietz2@illinois.edu>
Date: Wed, 27 May 2015 23:33:24 +0000
Subject: [PATCH] CallTargets: Actually erase duplicate callee entries once
 identified.

Also, use same comparator for unique() determination as used when doing
original sort.



git-svn-id: https://llvm.org/svn/llvm-project/poolalloc/trunk@238381 91177308-0d34-0410-b5e6-96231b3b80d8
---
 lib/DSA/CallTargets.cpp | 12 +++++++-----
 1 file changed, 7 insertions(+), 5 deletions(-)

diff --git a/lib/DSA/CallTargets.cpp b/lib/DSA/CallTargets.cpp
index 32da7272..4306d30f 100644
--- a/lib/DSA/CallTargets.cpp
+++ b/lib/DSA/CallTargets.cpp
@@ -166,11 +166,13 @@ bool CallTargetFinder<dsa>::runOnModule(Module &M) {
   // Sort callees alphabetically, remove duplicates
   for(auto &i: IndMap) {
     auto &callees = i.second;
-    std::sort(callees.begin(), callees.end(),
-              [](const Function *a, const Function *b) {
-                return a->getName() < b->getName();
-              });
-    std::unique(callees.begin(), callees.end());
+    auto FuncNameCmp = [](const Function *a, const Function *b) {
+      return a->getName() < b->getName();
+    };
+
+    std::sort(callees.begin(), callees.end(), FuncNameCmp);
+    callees.erase(std::unique(callees.begin(), callees.end(), FuncNameCmp),
+                  callees.end());
   }
 
   return false;
