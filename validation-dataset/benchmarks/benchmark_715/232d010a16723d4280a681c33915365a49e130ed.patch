From 232d010a16723d4280a681c33915365a49e130ed Mon Sep 17 00:00:00 2001
From: rick <technoweenie@gmail.com>
Date: Sat, 3 Dec 2011 09:19:19 -0700
Subject: [PATCH] don't cache the data for iterations in memory

---
 ext/leveldb/leveldb.cc | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/ext/leveldb/leveldb.cc b/ext/leveldb/leveldb.cc
index 034c21b..b9b04dd 100644
--- a/ext/leveldb/leveldb.cc
+++ b/ext/leveldb/leveldb.cc
@@ -145,7 +145,9 @@ static VALUE db_size(VALUE self) {
 static VALUE db_iterate(VALUE self, VALUE key_from, VALUE key_to, bool reversed) {
   bound_db* db;
   Data_Get_Struct(self, bound_db, db);
-  leveldb::Iterator* it = db->db->NewIterator(leveldb::ReadOptions());
+  leveldb::ReadOptions readOptions;
+  readOptions.fill_cache = false;
+  leveldb::Iterator* it = db->db->NewIterator(readOptions);
   ID to_s = rb_intern("to_s");
 
   if(RTEST(key_from)) {
