From e61e543f226bcdcb100e84f0be3127847e7aa8f2 Mon Sep 17 00:00:00 2001
From: Sam Clegg <sbc@chromium.org>
Date: Wed, 10 Jan 2018 20:12:26 +0000
Subject: [PATCH] [WebAssembly] Optimize Writer::lookupType

Followup on https://reviews.llvm.org/D41894
---
 lld/wasm/Writer.cpp | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/lld/wasm/Writer.cpp b/lld/wasm/Writer.cpp
index d6578957b543..1e51b70f770a 100644
--- a/lld/wasm/Writer.cpp
+++ b/lld/wasm/Writer.cpp
@@ -571,9 +571,12 @@ void Writer::calculateImports() {
 }
 
 uint32_t Writer::lookupType(const WasmSignature &Sig) {
-  if (TypeIndices.count(Sig) == 0)
+  auto It = TypeIndices.find(Sig);
+  if (It == TypeIndices.end()) {
     error("type not found: " + toString(Sig));
-  return TypeIndices.lookup(Sig);
+    return 0;
+  }
+  return It->second;
 }
 
 uint32_t Writer::registerType(const WasmSignature &Sig) {
