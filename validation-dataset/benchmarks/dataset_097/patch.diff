From d73891cce8bc63d833bc5ce69594a6902d2f7a03 Mon Sep 17 00:00:00 2001
From: Ravbug <ravbug@users.noreply.github.com>
Date: Thu, 10 Oct 2024 17:55:18 -0400
Subject: [PATCH] Use the remap table

---
 tools/rvemc/rvemc.cpp | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/tools/rvemc/rvemc.cpp b/tools/rvemc/rvemc.cpp
index b3446a6c9..aa8dd9a90 100644
--- a/tools/rvemc/rvemc.cpp
+++ b/tools/rvemc/rvemc.cpp
@@ -89,7 +89,7 @@ std::variant<MeshPart, SkinnedMeshPart> LoadMesh(const std::filesystem::path& pa
     
     // optimize mesh
     
-    std::vector<uint32_t> remap(mesh.indices.size()); // allocate temporary memory for the remap table
+    std::vector<uint32_t> remap(mesh.vertices.size()); // allocate temporary memory for the remap table
     size_t vertex_count = meshopt_generateVertexRemap(remap.data(), mesh.indices.data(), mesh.indices.size(), mesh.vertices.data(), mesh.vertices.size(), sizeof(vertex_t));
     
     meshopt_remapIndexBuffer(mesh.indices.data(),mesh.indices.data(),mesh.indices.size(),remap.data());
@@ -131,7 +131,7 @@ std::variant<MeshPart, SkinnedMeshPart> LoadMesh(const std::filesystem::path& pa
                 for (int j = 0; j < bone->mNumWeights; j++) {
                     auto weightval = bone->mWeights[j];
 
-                    allweights[weightval.mVertexId + current_offset].weights.push_back({ VertexWeights::vweights::vw{idx,weightval.mWeight} });
+                    allweights[remap[weightval.mVertexId] + current_offset].weights.push_back({ VertexWeights::vweights::vw{idx,weightval.mWeight} });
                 }
 
             }
