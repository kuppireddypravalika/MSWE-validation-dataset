From aa0e5f320533c01b40c5fdf8971105604056ac9f Mon Sep 17 00:00:00 2001
From: arcbbb <shihpo.hung@bitmain.com>
Date: Fri, 9 Mar 2018 15:59:01 +0800
Subject: [PATCH] MaxPool: use ceil for shape calculation as caffe

---
 tools/unittests/bitmain/llc/TGBackend.h | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/tools/unittests/bitmain/llc/TGBackend.h b/tools/unittests/bitmain/llc/TGBackend.h
index 3cb590671..bf2298d06 100644
--- a/tools/unittests/bitmain/llc/TGBackend.h
+++ b/tools/unittests/bitmain/llc/TGBackend.h
@@ -115,8 +115,10 @@ void updatePoolOutputDim(onnx::Node *const node) {
 
   int64_t oN = iN;
   int64_t oC = iC;
-  int64_t oH = (iH - kH + xb + xe) / sH + 1;
-  int64_t oW = (iW - kW + yb + ye) / sW + 1;
+  int64_t oH = static_cast<int64_t>(ceil(static_cast<float>(
+      iH - kH + xb + xe) / sH)) + 1;
+  int64_t oW = static_cast<int64_t>(ceil(static_cast<float>(
+      iW - kW + yb + ye) / sW)) + 1;
 
   std::vector<onnx::Dimension> outDims{ onnx::Dimension(oN),
                                         onnx::Dimension(oC),
