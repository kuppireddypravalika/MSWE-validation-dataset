From f30034714a69dc9ba5eebd2e56c7dde9696921ac Mon Sep 17 00:00:00 2001
From: Pilow <pierre.laupretre@gmail.com>
Date: Wed, 12 Apr 2017 23:26:52 +0200
Subject: [PATCH] [compiler] Use VM::get_exception_object in inc_ops_jit method

---
 src/compiler/Compiler.cpp | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/src/compiler/Compiler.cpp b/src/compiler/Compiler.cpp
index 6dcf59b9..15024525 100644
--- a/src/compiler/Compiler.cpp
+++ b/src/compiler/Compiler.cpp
@@ -767,9 +767,9 @@ void Compiler::inc_ops_jit(Compiler::value amount) {
 	jit_insn_branch_if_not(F, compare, &label_end);
 
 	// If greater than the limit, throw exception
-	jit_insn_throw(F, insn_call(Type::POINTER, {}, +[]() {
-		return new VM::ExceptionObj(VM::Exception::OPERATION_LIMIT_EXCEEDED);
-	}).v);
+	auto type = new_integer(VM::Exception::OPERATION_LIMIT_EXCEEDED);
+	auto ex = insn_call(Type::POINTER, {type}, &VM::get_exception_object<0>);
+	jit_insn_throw(F, ex.v);
 
 	// End
 	jit_insn_label(F, &label_end);
