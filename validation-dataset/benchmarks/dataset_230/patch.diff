From acd7af5e9a836ab50af8eb4e37f289e14f759849 Mon Sep 17 00:00:00 2001
From: James Yonan <james@openvpn.net>
Date: Mon, 17 Jun 2019 16:12:33 -0600
Subject: [PATCH] RandomAPI: added randrange32() method

Signed-off-by: James Yonan <james@openvpn.net>
---
 openvpn/random/randapi.hpp | 11 +++++++++++
 1 file changed, 11 insertions(+)

diff --git a/openvpn/random/randapi.hpp b/openvpn/random/randapi.hpp
index 667eba02b..1d75a3206 100644
--- a/openvpn/random/randapi.hpp
+++ b/openvpn/random/randapi.hpp
@@ -25,6 +25,7 @@
 #define OPENVPN_MBEDTLS_UTIL_RANDAPI_H
 
 #include <string>
+#include <cstdint>
 
 #include <openvpn/common/size.hpp>
 #include <openvpn/common/rc.hpp>
@@ -84,6 +85,16 @@ namespace openvpn {
       return rand_get_positive<T>() % end;
     }
 
+    // Return a uniformly distributed random number in the range [0, end).
+    // This version is strictly 32-bit only and optimizes by avoiding
+    // integer division.
+    std::uint32_t randrange32(const std::uint32_t end)
+    {
+      std::uint32_t r;
+      rand_fill(r);
+      return (std::uint64_t(r) * end) >> 32;
+    }
+
     // Return a uniformly distributed random number in the range [start, end].
     template <typename T>
     T randrange(const T start, const T end)
