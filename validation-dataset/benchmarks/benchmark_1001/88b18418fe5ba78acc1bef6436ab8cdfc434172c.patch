From 88b18418fe5ba78acc1bef6436ab8cdfc434172c Mon Sep 17 00:00:00 2001
From: JayXon <jayxon@gmail.com>
Date: Thu, 7 Aug 2014 12:08:03 -0400
Subject: [PATCH] enable optimize coding in fast mode for jpeg

---
 formats/jpeg.cpp | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/formats/jpeg.cpp b/formats/jpeg.cpp
index 031daf8..f77a399 100644
--- a/formats/jpeg.cpp
+++ b/formats/jpeg.cpp
@@ -17,10 +17,8 @@ size_t Jpeg::Leanify(size_t size_leanified /*= 0*/)
     dstinfo.err = jpeg_std_error(&jdsterr);
     jpeg_create_compress(&dstinfo);
 
-    if (is_recompress)
-    {
-        dstinfo.use_moz_defaults = TRUE;
-    }
+    dstinfo.use_moz_defaults = is_recompress;
+
     if (is_verbose)
     {
         dstinfo.err->trace_level++;
@@ -38,6 +36,8 @@ size_t Jpeg::Leanify(size_t size_leanified /*= 0*/)
     /* Initialize destination compression parameters from source values */
     jpeg_copy_critical_parameters(&srcinfo, &dstinfo);
 
+    dstinfo.optimize_coding = TRUE;
+
     unsigned char *outbuffer = NULL;
     unsigned long outsize = 0;
     /* Specify data destination for compression */
