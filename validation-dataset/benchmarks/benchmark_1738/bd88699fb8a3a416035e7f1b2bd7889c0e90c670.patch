From bd88699fb8a3a416035e7f1b2bd7889c0e90c670 Mon Sep 17 00:00:00 2001
From: Pilow <pierre.laupretre@gmail.com>
Date: Wed, 19 Jun 2019 20:40:49 +0200
Subject: [PATCH] [lexical] Optimize lexical analyzer : don't scan ut8
 characters twice

---
 src/compiler/lexical/LexicalAnalyzer.cpp | 14 ++++++--------
 1 file changed, 6 insertions(+), 8 deletions(-)

diff --git a/src/compiler/lexical/LexicalAnalyzer.cpp b/src/compiler/lexical/LexicalAnalyzer.cpp
index 1452761c..cede9ee2 100644
--- a/src/compiler/lexical/LexicalAnalyzer.cpp
+++ b/src/compiler/lexical/LexicalAnalyzer.cpp
@@ -160,19 +160,17 @@ std::vector<Token*> LexicalAnalyzer::parseTokens(std::string code) {
 	int comment = 0;
 	bool lineComment = false;
 
-	int i = 0;
 	int l = strlen(string_chars);
+	int i = 0, j = 0;
+	u_int32_t c, nc = u8_nextchar(string_chars, &j);
 
 	while (i < l) {
 
 		character++;
-
-		u_int32_t c = u8_nextchar(string_chars, &i);
-		int oldi = i;
-		u_int32_t nc = u8_nextchar(string_chars, &i);
-		i = oldi;
-
-		LetterType type = getLetterType(c);
+		c = nc;
+		i = j;
+		nc = u8_nextchar(string_chars, &j);
+		auto type = getLetterType(c);
 
 		if (lineComment) {
 			if (c == '\n') {
