From 8eb86a867251e79c83ae847c493492bc657ebc32 Mon Sep 17 00:00:00 2001
From: Halvor Lyche Strandvoll <halvors@halvors.org>
Date: Mon, 1 Mar 2021 12:41:05 +0100
Subject: [PATCH] Optimized the setHidden function.

---
 src/app/fileutils.cpp | 10 +++++-----
 1 file changed, 5 insertions(+), 5 deletions(-)

diff --git a/src/app/fileutils.cpp b/src/app/fileutils.cpp
index ac0e864..4d3e2db 100644
--- a/src/app/fileutils.cpp
+++ b/src/app/fileutils.cpp
@@ -49,24 +49,24 @@ QString FileUtils::appendToName(const QDir &dir, const QString &fileName, const
 bool FileUtils::setHidden(const QDir &dir, const QString &fileName, bool hidden)
 {
     bool prefix = fileName.startsWith(game_hidden_prefix);
+    bool success = true;
+
+#if defined(Q_OS_LINUX)
     QString newFileName = QString(fileName);
 
     if (hidden && !prefix) {
-        newFileName = newFileName.prepend(game_hidden_prefix);
+        newFileName.prepend(game_hidden_prefix);
     } else if (!hidden && prefix) {
         newFileName.remove(0, 1);
     }
 
-    bool success = true;
-
-#if defined(Q_OS_LINUX)
     QFile file = dir.filePath(fileName);
     QString newFilePath = dir.filePath(newFileName);
     file.rename(newFilePath);
 
     success &= newFileName.startsWith(game_hidden_prefix) == hidden;
 #elif defined(Q_OS_WIN)
-    std::wstring newFileNameW = dir.filePath(newFileName).toStdWString();
+    std::wstring newFileNameW = dir.filePath(fileName).toStdWString();
     DWORD attributes = GetFileAttributesW(newFileNameW.c_str());
 
     if (hidden)
