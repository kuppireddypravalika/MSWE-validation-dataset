From 280f8c1d458b4f2b940c9c7143e752855c789fae Mon Sep 17 00:00:00 2001
From: Magne Sjaastad <magne.sjaastad@ceetronsolutions.com>
Date: Tue, 12 Nov 2019 18:26:47 +0100
Subject: [PATCH] #5031 Summary Data : Only use openMP on open of summary file

---
 .../Summary/RimSummaryCaseMainCollection.cpp             | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/ApplicationCode/ProjectDataModel/Summary/RimSummaryCaseMainCollection.cpp b/ApplicationCode/ProjectDataModel/Summary/RimSummaryCaseMainCollection.cpp
index 3a3514fc1c9..e1c046ed814 100644
--- a/ApplicationCode/ProjectDataModel/Summary/RimSummaryCaseMainCollection.cpp
+++ b/ApplicationCode/ProjectDataModel/Summary/RimSummaryCaseMainCollection.cpp
@@ -399,6 +399,7 @@ void RimSummaryCaseMainCollection::loadFileSummaryCaseData( std::vector<RimFileS
 {
     // Use openMP when reading file summary case meta data. Avoid using the virtual interface of base class
     // RimSummaryCase, as it is difficult to make sure all variants of the leaf classes are thread safe.
+    // Only open the summary file reader in parallel loop to reduce risk of multithreading issues
 
 #pragma omp parallel for
     for ( int cIdx = 0; cIdx < static_cast<int>( fileSummaryCases.size() ); ++cIdx )
@@ -407,6 +408,14 @@ void RimSummaryCaseMainCollection::loadFileSummaryCaseData( std::vector<RimFileS
         if ( fileSummaryCase )
         {
             fileSummaryCase->createSummaryReaderInterface();
+        }
+    }
+
+    for ( int cIdx = 0; cIdx < static_cast<int>( fileSummaryCases.size() ); ++cIdx )
+    {
+        RimFileSummaryCase* fileSummaryCase = fileSummaryCases[cIdx];
+        if ( fileSummaryCase )
+        {
             fileSummaryCase->createRftReaderInterface();
             addCaseRealizationParametersIfFound( *fileSummaryCase, fileSummaryCase->summaryHeaderFilename() );
         }
