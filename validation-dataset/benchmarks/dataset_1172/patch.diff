From 6af24dfc2bae6b105e3d8043fd9a60e1901c47e2 Mon Sep 17 00:00:00 2001
From: Hendrik Leppkes <h.leppkes@gmail.com>
Date: Tue, 16 Feb 2016 21:29:52 +0100
Subject: [PATCH] Only compare timestamps if they are actually set

---
 demuxer/Demuxers/BDDemuxer.cpp | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/demuxer/Demuxers/BDDemuxer.cpp b/demuxer/Demuxers/BDDemuxer.cpp
index c9181b8bb..761d4be71 100644
--- a/demuxer/Demuxers/BDDemuxer.cpp
+++ b/demuxer/Demuxers/BDDemuxer.cpp
@@ -385,7 +385,7 @@ STDMETHODIMP CBDDemuxer::FillMVCExtensionQueue(REFERENCE_TIME rtBase)
     return E_FAIL;
 
   int ret, count = 0;
-  bool found = false;
+  bool found = (rtBase == Packet::INVALID_TIME);
 
   AVPacket mvcPacket = { 0 };
   av_init_packet(&mvcPacket);
@@ -410,7 +410,9 @@ STDMETHODIMP CBDDemuxer::FillMVCExtensionQueue(REFERENCE_TIME rtBase)
       REFERENCE_TIME rtDTS = m_lavfDemuxer->ConvertTimestampToRT(mvcPacket.dts, stream->time_base.num, stream->time_base.den);
       REFERENCE_TIME rtPTS = m_lavfDemuxer->ConvertTimestampToRT(mvcPacket.pts, stream->time_base.num, stream->time_base.den);
 
-      if (rtDTS < rtBase) {
+      if (rtBase == Packet::INVALID_TIME || rtDTS == Packet::INVALID_TIME) {
+        // do nothing, can't compare timestamps when they are not set
+      } else if (rtDTS < rtBase) {
         av_packet_unref(&mvcPacket);
         continue;
       }
