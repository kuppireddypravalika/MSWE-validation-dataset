From af446ae5a5bcd0d7267ffd37a591b9475e42f2c7 Mon Sep 17 00:00:00 2001
From: Davide Faconti <davide.faconti@gmail.com>
Date: Wed, 8 Jun 2022 14:19:47 -0700
Subject: [PATCH] pre-allocate memory in the buffer

---
 include/ros2_logging_fmt/ros2_logging_fmt.hpp | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/include/ros2_logging_fmt/ros2_logging_fmt.hpp b/include/ros2_logging_fmt/ros2_logging_fmt.hpp
index acc0230..c31b44d 100644
--- a/include/ros2_logging_fmt/ros2_logging_fmt.hpp
+++ b/include/ros2_logging_fmt/ros2_logging_fmt.hpp
@@ -45,7 +45,12 @@ class Logger
   template<typename... Args>
   const char* write_buffer(const char* str, Args... args)
   {
-    static thread_local std::string buffer;
+    static thread_local std::string buffer = [](){ // reserve 1000 characters
+      std::string tmp; 
+      tmp.reserve(500);
+      return tmp;
+    }();
+    
     buffer.clear();
     fmt::format_to(std::back_inserter(buffer), str, args...);
     return buffer.c_str();
