From e199394e27b4ac6b529f58e1d2086191a90853e7 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Can=20B=C3=B6l=C3=BCk?= <can.boluk89@gmail.com>
Date: Sat, 27 Jun 2020 03:39:24 +0200
Subject: [PATCH] Equals will invoke simplification so improve perf by changing
 the order.

---
 VTIL-Compiler/optimizer/symbolic_rewrite_pass.cpp | 8 +-------
 1 file changed, 1 insertion(+), 7 deletions(-)

diff --git a/VTIL-Compiler/optimizer/symbolic_rewrite_pass.cpp b/VTIL-Compiler/optimizer/symbolic_rewrite_pass.cpp
index 19777510..d15462a8 100644
--- a/VTIL-Compiler/optimizer/symbolic_rewrite_pass.cpp
+++ b/VTIL-Compiler/optimizer/symbolic_rewrite_pass.cpp
@@ -133,7 +133,7 @@ namespace vtil::optimizer
 			{
 				// If value is unchanged, skip.
 				//
-				auto k = pair.first; auto v = pair.second;
+				auto k = pair.first; auto v = pair.second.simplify();
 				symbolic::expression v0 = symbolic::make_register_ex( k );
 				if ( v0.equals( v ) )
 					continue;
@@ -142,12 +142,6 @@ namespace vtil::optimizer
 				//
 				if ( !aux::is_used( { std::prev( limit ), k }, false, &ctracer ) )
 					continue;
-
-				// Simplify value and check unchanged-state again.
-				//
-				v.simplify();
-				if ( v0.equals( v ) )
-					continue;
 				
 				// Try minimizing expression size.
 				//
