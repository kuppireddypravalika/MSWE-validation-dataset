From 9ad1f42b95993a99cfb076199fac22ae457d545c Mon Sep 17 00:00:00 2001
From: Even Rouault <even.rouault@mines-paris.org>
Date: Wed, 10 Jan 2018 12:35:41 +0000
Subject: [PATCH] VRTDerivedRasterBand: limit BufferRadius to 1024 to avoid
 excessive memory allocation attempts. Fixes
 https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=5216. Credit to OSS
 Fuzz

git-svn-id: https://svn.osgeo.org/gdal/trunk@41238 f0d54148-0727-0410-94bb-9a71ac55c965
---
 gdal/frmts/vrt/vrtderivedrasterband.cpp | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/gdal/frmts/vrt/vrtderivedrasterband.cpp b/gdal/frmts/vrt/vrtderivedrasterband.cpp
index 6d8b19408add..69fa9e9fc405 100644
--- a/gdal/frmts/vrt/vrtderivedrasterband.cpp
+++ b/gdal/frmts/vrt/vrtderivedrasterband.cpp
@@ -2000,7 +2000,8 @@ CPLErr VRTDerivedRasterBand::XMLInit( CPLXMLNode *psTree,
 
     m_poPrivate->m_nBufferRadius =
                         atoi(CPLGetXMLValue( psTree, "BufferRadius", "0" ));
-    if( m_poPrivate->m_nBufferRadius < 0 )
+    if( m_poPrivate->m_nBufferRadius < 0 ||
+        m_poPrivate->m_nBufferRadius > 1024 )
     {
         CPLError(CE_Failure, CPLE_AppDefined, "Invalid value for BufferRadius");
         return CE_Failure;
