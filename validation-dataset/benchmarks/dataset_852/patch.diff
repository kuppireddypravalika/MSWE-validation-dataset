From ce64c1e87dccc6dffdc9f9b1ff9412da5fecbc8e Mon Sep 17 00:00:00 2001
From: David Korth <gerbilsoft@gerbilsoft.com>
Date: Sun, 18 Jun 2017 00:22:32 -0400
Subject: [PATCH] [libromdata] RomDataFactory: Quick and dirty optimization for
 SMS/GG headers.

Don't check the SMS/GG header if the file extension isn't .sms or .gg,
since it requires reading more data from the ROM file.

TODO: Don't hard-code this. Maybe add a list of file extensions, or a
pointer to the supportedFileExtensions_static() function.
---
 src/libromdata/RomDataFactory.cpp | 15 +++++++++++++++
 1 file changed, 15 insertions(+)

diff --git a/src/libromdata/RomDataFactory.cpp b/src/libromdata/RomDataFactory.cpp
index c2183cec65..5718f0a65c 100644
--- a/src/libromdata/RomDataFactory.cpp
+++ b/src/libromdata/RomDataFactory.cpp
@@ -343,6 +343,21 @@ RomData *RomDataFactory::create(IRpFile *file, bool thumbnail)
 		    fns->size > info.header.size)
 		{
 			// Header address has changed.
+
+			// Check the file extension to reduce overhead
+			// for file types that don't use this.
+			// TODO: Don't hard-code this.
+			// Use a pointer to supportedFileExtensions_static() instead?
+			if (info.ext == nullptr) {
+				// No file extension...
+				break;
+			} else if (rp_strcasecmp(info.ext, _RP(".sms")) != 0 &&
+				   rp_strcasecmp(info.ext, _RP(".gg")) != 0)
+			{
+				// Not SMS or Game Gear.
+				break;
+			}
+
 			// Read the new header data.
 
 			// NOTE: fns->size == 0 is only correct
