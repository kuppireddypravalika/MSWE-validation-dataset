From a857aaa4567cdaa8e77aa3e6ed1fcc18bc126a1a Mon Sep 17 00:00:00 2001
From: Even Rouault <even.rouault@mines-paris.org>
Date: Wed, 27 Nov 2013 14:19:07 +0000
Subject: [PATCH] DXF: avoid building an invalid polygon from A POLYGON when
 edges cannot be reassembled: turn it into a multilinestring

git-svn-id: https://svn.osgeo.org/gdal/trunk@26670 f0d54148-0727-0410-94bb-9a71ac55c965
---
 gdal/ogr/ogrsf_frmts/dxf/ogrdxf_hatch.cpp | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/gdal/ogr/ogrsf_frmts/dxf/ogrdxf_hatch.cpp b/gdal/ogr/ogrsf_frmts/dxf/ogrdxf_hatch.cpp
index f55943dc6d50..130092e335d9 100644
--- a/gdal/ogr/ogrsf_frmts/dxf/ogrdxf_hatch.cpp
+++ b/gdal/ogr/ogrsf_frmts/dxf/ogrdxf_hatch.cpp
@@ -102,6 +102,14 @@ OGRFeature *OGRDXFLayer::TranslateHATCH()
     OGRGeometry* poFinalGeom = (OGRGeometry *)
         OGRBuildPolygonFromEdges( (OGRGeometryH) &oGC,
                                   TRUE, TRUE, 0.0000001, &eErr );
+    if( eErr != OGRERR_NONE )
+    {
+        delete poFinalGeom;
+        OGRMultiLineString* poMLS = new OGRMultiLineString();
+        for(int i=0;i<oGC.getNumGeometries();i++)
+            poMLS->addGeometry(oGC.getGeometryRef(i));
+        poFinalGeom = poMLS;
+    }
 
     ApplyOCSTransformer( poFinalGeom );
     poFeature->SetGeometryDirectly( poFinalGeom );
