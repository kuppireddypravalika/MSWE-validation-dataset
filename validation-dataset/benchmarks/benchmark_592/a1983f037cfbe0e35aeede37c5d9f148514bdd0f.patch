From a1983f037cfbe0e35aeede37c5d9f148514bdd0f Mon Sep 17 00:00:00 2001
From: David Anderson <danderson@mozilla.com>
Date: Sun, 20 Jun 2010 13:17:45 -0700
Subject: [PATCH] [JAEGER] Use cheaper comparison for GETPROP type checks.

---
 js/src/methodjit/Compiler.cpp | 7 ++-----
 1 file changed, 2 insertions(+), 5 deletions(-)

diff --git a/js/src/methodjit/Compiler.cpp b/js/src/methodjit/Compiler.cpp
index 9b63cdcdd33..8e21b49dbd3 100644
--- a/js/src/methodjit/Compiler.cpp
+++ b/js/src/methodjit/Compiler.cpp
@@ -1842,16 +1842,13 @@ mjit::Compiler::jsop_getprop(uint32 atomIndex)
     Jump typeMismatch;
     bool typeMismatchSet = false;
     if (!top->isTypeKnown()) {
+        JS_STATIC_ASSERT(JSVAL_MASK32_NONFUNOBJ < JSVAL_MASK32_FUNOBJ);
         RegisterID reg = frame.tempRegForType(top);
-        RegisterID type = frame.allocReg();
-        masm.move(reg, type);
-        masm.and32(Imm32(JSVAL_MASK32_OBJECT), type);
-        Jump j = masm.branch32(Assembler::BelowOrEqual, type, Imm32(JSVAL_MASK32_CLEAR));
+        Jump j = masm.branch32(Assembler::Below, reg, Imm32(JSVAL_MASK32_NONFUNOBJ));
         stubcc.linkExit(j);
         stubcc.leave();
         stubcc.call(stubs::GetProp);
         typeMismatch = stubcc.masm.jump();
-        frame.freeReg(type);
         typeMismatchSet = true;
     }
 
