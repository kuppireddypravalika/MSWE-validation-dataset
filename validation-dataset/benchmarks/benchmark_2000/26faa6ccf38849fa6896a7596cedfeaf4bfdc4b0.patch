From 26faa6ccf38849fa6896a7596cedfeaf4bfdc4b0 Mon Sep 17 00:00:00 2001
From: Pilow <pierre.laupretre@gmail.com>
Date: Fri, 10 May 2019 21:34:16 +0200
Subject: [PATCH] [callable] Use insn_call only if the function doesn't throw

---
 src/compiler/semantic/Callable.cpp | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/src/compiler/semantic/Callable.cpp b/src/compiler/semantic/Callable.cpp
index 06afd92f..77c8c4ca 100644
--- a/src/compiler/semantic/Callable.cpp
+++ b/src/compiler/semantic/Callable.cpp
@@ -185,7 +185,11 @@ Compiler::value CallableVersion::compile_call(Compiler& c, std::vector<Compiler:
 				args.insert(args.begin(), {user_fun->f, Type::any()});
 			}
 		}
-		return c.insn_invoke(type.return_type(), args, user_fun->f);
+		if (flags & Module::THROWS) {
+			return c.insn_invoke(type.return_type(), args, user_fun->f);
+		} else {
+			return c.insn_call(type.return_type(), args, user_fun->f);
+		}
 	} else if (addr) {
 		if (flags & Module::THROWS) {
 			return c.insn_invoke(type.return_type(), args, name);
