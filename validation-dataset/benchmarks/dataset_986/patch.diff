From 1da0a5afaab933895beefd2dc8b9aeae896ae04f Mon Sep 17 00:00:00 2001
From: Zegeri <zegeridp@gmail.com>
Date: Sat, 21 Nov 2015 14:05:03 +0100
Subject: [PATCH] Optimize screen effects drawing

Screen::Draw copies the whole display surface apply changes to it and then replaces the surface with its copy (even if there are no screen effects).  Now it modifies the display surface directly like other drawable objects.
---
 src/screen.cpp | 7 ++-----
 1 file changed, 2 insertions(+), 5 deletions(-)

diff --git a/src/screen.cpp b/src/screen.cpp
index 6eb1d9db23..cd73fea7ca 100644
--- a/src/screen.cpp
+++ b/src/screen.cpp
@@ -48,12 +48,11 @@ void Screen::Update() {
 
 void Screen::Draw() {
 	BitmapRef disp = DisplayUi->GetDisplaySurface();
-	BitmapRef dst = Bitmap::Create(*disp, disp->GetRect());
 
 	Tone tone = Main_Data::game_screen->GetTone();
 
 	if (tone != default_tone) {
-		dst->ToneBlit(0, 0, *disp, Rect(0, 0, SCREEN_TARGET_WIDTH, SCREEN_TARGET_HEIGHT), tone, Opacity::opaque);
+		disp->ToneBlit(0, 0, *disp, Rect(0, 0, SCREEN_TARGET_WIDTH, SCREEN_TARGET_HEIGHT), tone, Opacity::opaque);
 	}
 
 	int flash_time_left;
@@ -66,8 +65,6 @@ void Screen::Draw() {
 		} else {
 			flash->Fill(flash_color);
 		}
-		dst->Blit(0, 0, *flash, flash->GetRect(), flash_current_level);
+		disp->Blit(0, 0, *flash, flash->GetRect(), flash_current_level);
 	}
-
-	disp->Blit(0, 0, *dst, dst->GetRect(), Opacity::opaque);
 }
