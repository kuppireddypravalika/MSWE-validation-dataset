From 5e0c13f1882c7742a9456f164594dbe99407fd46 Mon Sep 17 00:00:00 2001
From: manuelk <mkraemer@pixar.com>
Date: Thu, 22 Jan 2015 11:06:33 -0800
Subject: [PATCH] Add a fast code path to bypass frame interpolation when
 reading single (non-animated) OBJ files

---
 examples/common/objAnim.cpp | 14 ++++++++++++++
 1 file changed, 14 insertions(+)

diff --git a/examples/common/objAnim.cpp b/examples/common/objAnim.cpp
index 53e67585c..e3f98cfd8 100644
--- a/examples/common/objAnim.cpp
+++ b/examples/common/objAnim.cpp
@@ -29,6 +29,7 @@
 #include <cassert>
 #include <cstdio>
 #include <cmath>
+#include <cstring>
 #include <fstream>
 #include <sstream>
 
@@ -54,6 +55,19 @@ ObjAnim::InterpolatePositions(float time, float * positions, int stride) const {
     int nkeys = GetNumKeyframes(),
         nverts = GetShape()->GetNumVertices();
 
+    assert(nkeys>0);
+
+    if (nkeys==1) {
+        // nothing to interpolate - just copy the coarse verts positions
+        float const * vert = &_positions[0][0];
+        for (int i = 0; i <nverts; ++i) {
+             memcpy( positions, vert, sizeof(float)*3);
+             positions += stride;
+             vert += 3;
+        }
+        return;
+    }
+
     const float fps = 24.0f;
 
     float p = fmodf(time * fps, (float)nkeys);
