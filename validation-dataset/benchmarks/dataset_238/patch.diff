From ef4f68821277d84fe6874faa13bdb14974148a1f Mon Sep 17 00:00:00 2001
From: Compsky <adammarkgray@gmail.com>
Date: Tue, 21 May 2019 07:48:39 +0100
Subject: [PATCH] Performance: Changed from malloc to fixed-length buffer

---
 utils/src/myfmt.cpp | 9 ++++-----
 1 file changed, 4 insertions(+), 5 deletions(-)

diff --git a/utils/src/myfmt.cpp b/utils/src/myfmt.cpp
index 846ed8b4..465bed86 100644
--- a/utils/src/myfmt.cpp
+++ b/utils/src/myfmt.cpp
@@ -20,9 +20,8 @@ void write_dir(const char* fp, const int dir_len){
 }
 
 int main(const int argc, const char* argv[]){
-    size_t fp_len;
     int dir_len;
-    char* fp = (char*)malloc(0);
+    char fp[4096];
     char olddir[1024];
     int olddir_len = 0;
     int dir_match;
@@ -30,13 +29,13 @@ int main(const int argc, const char* argv[]){
     olddir[0] = 0;
     
     while (true){
-        if (getline(&fp, &fp_len, stdin) == -1)
+        if (getline(&fp, 4096, stdin) == -1)
             break;
         
-        fp_len = strlen(fp) - 1;
+        int fp_len = strlen(fp) - 1;
         
         dir_match = 0;
-        for (int i = 0;  i < fp_len;  ++i){
+        for (auto i = 0;  i < fp_len;  ++i){
             if (fp[i] == '/')
                 dir_len = i;
             if (i < olddir_len && fp[i] == olddir[i])
