From 8868505bc1653239c480579847a714287e987591 Mon Sep 17 00:00:00 2001
From: Olly Betts <olly@survex.com>
Date: Wed, 14 Apr 2021 09:15:08 +1200
Subject: [PATCH] Optimise Glass::Inverter::has_positions()

Use const auto& instead of just auto for the loop variables.
Reported to be faster by andreas on #notmuch.
---
 xapian-core/backends/glass/glass_inverter.cc | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/xapian-core/backends/glass/glass_inverter.cc b/xapian-core/backends/glass/glass_inverter.cc
index 6edd6c52438..c446057362a 100644
--- a/xapian-core/backends/glass/glass_inverter.cc
+++ b/xapian-core/backends/glass/glass_inverter.cc
@@ -134,9 +134,9 @@ Inverter::has_positions(const GlassPositionListTable & position_table) const
     // FIXME: Can we cheaply keep track of some things to make this more
     // efficient?  E.g. how many sets and deletes we had in total perhaps.
     glass_tablesize_t changes = 0;
-    for (auto i : pos_changes) {
+    for (const auto& i : pos_changes) {
 	const map<Xapian::docid, string>& m = i.second;
-	for (auto j : m) {
+	for (const auto& j : m) {
 	    const string & s = j.second;
 	    if (!s.empty())
 		return true;
