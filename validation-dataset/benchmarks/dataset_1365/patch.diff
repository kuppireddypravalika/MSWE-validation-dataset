From e5045651a0b695a72aeb2fb1696cedf0d9e57a2c Mon Sep 17 00:00:00 2001
From: Jorge Arellano Cid <jcid@dillo.org>
Date: Fri, 17 Jun 2016 11:18:51 -0400
Subject: [PATCH] Fix for CPU-hog bugs with deeply nested elements.

This patch fixes a cpu-hog regression of GROWS2 with respect to dillo-3.0.5.
The problem arises with some deeply nested elements. e.g.:

  (for i in $(seq 1 20); do echo '<div style="float:left"><div></div><div
  style="display:table"><span></div></div>'; done) > t0.html

  (for i in $(seq 1 20); do echo '<div style="float:left"><div></div><div
  style="display:table"></div>'; done) > t1.html

For both, taking away the SPAN or float is much faster.

Note: Some "unrelated" sited (i.e. not clearly hogging the CPU) have been
measured to render near two times faster with the patch.
---
 dw/textblock.cc | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/dw/textblock.cc b/dw/textblock.cc
index f851fd4eb..beff9cd56 100644
--- a/dw/textblock.cc
+++ b/dw/textblock.cc
@@ -3034,7 +3034,7 @@ void Textblock::queueDrawRange (int index1, int index2)
 
 void Textblock::updateReference (int ref)
 {
-   if (lines->size () > 0)
+   if (lines->size () > 0) 
       queueResize (ref, false);
 }
 
