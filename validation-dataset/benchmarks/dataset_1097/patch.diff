From 267e96b8ad98abc57d0960866c5d270d335fca90 Mon Sep 17 00:00:00 2001
From: Roland Lichters <roland.lichers@quaternion.com>
Date: Mon, 21 Nov 2016 18:09:10 +0100
Subject: [PATCH] check eval date before updating it, accelerates sensitivity
 calculation

---
 OREAnalytics/orea/scenario/scenariosimmarket.cpp | 5 ++---
 1 file changed, 2 insertions(+), 3 deletions(-)

diff --git a/OREAnalytics/orea/scenario/scenariosimmarket.cpp b/OREAnalytics/orea/scenario/scenariosimmarket.cpp
index e3748b2dfb..2e8d8f4c69 100644
--- a/OREAnalytics/orea/scenario/scenariosimmarket.cpp
+++ b/OREAnalytics/orea/scenario/scenariosimmarket.cpp
@@ -410,7 +410,8 @@ void ScenarioSimMarket::update(const Date& d) {
 
     numeraire_ = scenario->getNumeraire();
 
-    Settings::instance().evaluationDate() = d;
+    if (d != Settings::instance().evaluationDate())
+        Settings::instance().evaluationDate() = d;
 
     const vector<RiskFactorKey>& keys = scenario->keys();
 
@@ -420,8 +421,6 @@ void ScenarioSimMarket::update(const Date& d) {
         // TODO: Is this really an error?
         auto it = simData_.find(key);
         QL_REQUIRE(it != simData_.end(), "simulation data point missing for key " << key);
-	//LOG("updating key " << key << " from " << it->second->value() << " to " << scenario->get(key));
-        //if (fabs(it->second->value() - scenario->get(key)) > tolerance)
 	it->second->setValue(scenario->get(key));
         count++;
     }
