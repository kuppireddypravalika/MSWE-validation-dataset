From 5cf225f0e3a50195136e4ac6348e326d78ee27be Mon Sep 17 00:00:00 2001
From: Rob Trangucci <robert.trangucci@gmail.com>
Date: Thu, 4 May 2017 17:44:30 -0400
Subject: [PATCH] Updates LLT to inplace decomposition per eigen 3.3 doc

---
 stan/math/rev/mat/fun/cholesky_decompose.hpp | 6 +-----
 1 file changed, 1 insertion(+), 5 deletions(-)

diff --git a/stan/math/rev/mat/fun/cholesky_decompose.hpp b/stan/math/rev/mat/fun/cholesky_decompose.hpp
index cf538ec18a6..2bc0c942895 100644
--- a/stan/math/rev/mat/fun/cholesky_decompose.hpp
+++ b/stan/math/rev/mat/fun/cholesky_decompose.hpp
@@ -233,8 +233,6 @@ namespace stan {
      * Internally calls llt rather than using cholesky_decompose in order to
      * use selfadjointView<Lower> optimization.
      *
-     * TODO(rtrangucci): Use Eigen 3.3 inplace Cholesky when possible
-     *
      * Note chainable stack varis are created below in Matrix<var, -1, -1>
      *
      * @param A Matrix
@@ -246,10 +244,8 @@ namespace stan {
       check_symmetric("cholesky_decompose", "A", A);
 
       Eigen::Matrix<double, -1, -1> L_A(value_of_rec(A));
-      Eigen::LLT<Eigen::MatrixXd> L_factor
-        = L_A.selfadjointView<Eigen::Lower>().llt();
+      Eigen::LLT<Eigen::Ref<Eigen::MatrixXd> > L_factor(L_A);
       check_pos_definite("cholesky_decompose", "m", L_factor);
-      L_A = L_factor.matrixL();
 
       // Memory allocated in arena.
       // cholesky_scalar gradient faster for small matrices compared to
