From b3836e268ce73360c4aee55cab8a0ec4ab09d851 Mon Sep 17 00:00:00 2001
From: Pierre Ducroquet <pinaraf@pinaraf.info>
Date: Tue, 23 Mar 2021 13:07:47 +0100
Subject: [PATCH] Shave some more performance using qobject_cast instead of
 dynamic_cast

---
 libs/textlayout/KoTextDocumentLayout.cpp | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/libs/textlayout/KoTextDocumentLayout.cpp b/libs/textlayout/KoTextDocumentLayout.cpp
index 2cd675c9ae3..1aaeb854a1b 100644
--- a/libs/textlayout/KoTextDocumentLayout.cpp
+++ b/libs/textlayout/KoTextDocumentLayout.cpp
@@ -611,8 +611,10 @@ void KoTextDocumentLayout::positionAnchorTextRanges(int pos, int length, const Q
             static_cast<AnchorStrategy *>(anchor->placementStrategy())->setParagraphRect(d->anchoringParagraphRect);
             static_cast<AnchorStrategy *>(anchor->placementStrategy())->setParagraphContentRect(d->anchoringParagraphContentRect);
             static_cast<AnchorStrategy *>(anchor->placementStrategy())->setLayoutEnvironmentRect(d->anchoringLayoutEnvironmentRect);
+
+            continue;
         }
-        KoAnnotation *annotation = dynamic_cast<KoAnnotation *>(range);
+        KoAnnotation *annotation = qobject_cast<KoAnnotation *>(range);
         if (annotation) {
             int position = range->rangeStart();
             QTextBlock block = range->document()->findBlock(position);
