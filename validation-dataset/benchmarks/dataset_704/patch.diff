From 7a0086397f5c3ba8f1972344ad3cebaf6a21cba2 Mon Sep 17 00:00:00 2001
From: visualfc <visualfc@gmail.com>
Date: Sat, 22 Dec 2018 22:58:58 +0800
Subject: [PATCH] litefind: file search check binary file and skip

---
 liteidex/src/plugins/litefind/filesearch.cpp | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/liteidex/src/plugins/litefind/filesearch.cpp b/liteidex/src/plugins/litefind/filesearch.cpp
index 8de45200b..ba519135a 100644
--- a/liteidex/src/plugins/litefind/filesearch.cpp
+++ b/liteidex/src/plugins/litefind/filesearch.cpp
@@ -44,6 +44,7 @@
 #include <QAction>
 #include <QCompleter>
 #include <QDebug>
+#include "editorutil/checkdata.h"
 //lite_memory_check_begin
 #if defined(WIN32) && defined(_MSC_VER) &&  defined(_DEBUG)
      #define _CRTDBG_MAP_ALLOC
@@ -94,6 +95,12 @@ void FindThread::findFile(const QRegExp &reg, const QString &fileName)
     if (!file.open(QIODevice::ReadOnly)) {
         return;
     }
+    //skip binary data
+    QByteArray head = file.read(32);
+    if (HasBinaryData(head,32)) {
+        return;
+    }
+    file.seek(0);
 
     QTextStream stream(&file);
     stream.setCodec("utf-8");
