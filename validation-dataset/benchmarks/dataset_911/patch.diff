From 4f4b8a85a3901daede29375fc60cc6c2a0a7d644 Mon Sep 17 00:00:00 2001
From: Jeroen Baert <3607063+Forceflow@users.noreply.github.com>
Date: Tue, 26 Oct 2021 11:43:24 +0200
Subject: [PATCH] Added faster magicbits 2D method for 64-bit morton codes.
 More info: https://gist.github.com/JarkkoPFC/0e4e599320b0cc7ea92df45fb416d79a

---
 include/libmorton/morton2D.h | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/include/libmorton/morton2D.h b/include/libmorton/morton2D.h
index b328a65..6031b04 100644
--- a/include/libmorton/morton2D.h
+++ b/include/libmorton/morton2D.h
@@ -114,6 +114,16 @@ namespace libmorton {
 		return morton2D_SplitBy2Bits<morton, coord>(x) | (morton2D_SplitBy2Bits<morton, coord>(y) << 1);
 	}
 
+	// ENCODE 2D 32-bit morton code - alternative version by JarkkoPFC - https://gist.github.com/JarkkoPFC/0e4e599320b0cc7ea92df45fb416d79a
+	inline uint_fast32_t m2D_e_magicbits_combined(uint_fast16_t x, uint_fast16_t y) {
+		uint_fast64_t res = x | (uint64_t(y) << 32);
+		res = (res | (res << 8)) & magicbit2D_masks64[2];
+		res = (res | (res << 4)) & magicbit2D_masks64[3];
+		res = (res | (res << 2)) & magicbit2D_masks64[4];
+		res = (res | (res << 1)) & magicbit2D_masks64[5];
+		return uint_fast32_t(res | (res >> 31));
+	}
+
 	// ENCODE 2D Morton code : For Loop
 	template<typename morton, typename coord>
 	inline morton m2D_e_for(const coord x, const coord y) {
