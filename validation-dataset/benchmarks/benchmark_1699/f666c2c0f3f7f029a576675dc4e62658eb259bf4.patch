From f666c2c0f3f7f029a576675dc4e62658eb259bf4 Mon Sep 17 00:00:00 2001
From: pk <pk@valec.net>
Date: Sun, 21 Oct 2018 17:57:22 +0200
Subject: [PATCH] Took terms out of omp loop.

---
 psi4/src/psi4/libmints/matrix.cc | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/psi4/src/psi4/libmints/matrix.cc b/psi4/src/psi4/libmints/matrix.cc
index ddaaa5e245e..43093bc1283 100644
--- a/psi4/src/psi4/libmints/matrix.cc
+++ b/psi4/src/psi4/libmints/matrix.cc
@@ -1251,11 +1251,11 @@ double Matrix::rms() {
     double sum = (double)0.0;
     long terms = 0;
     for (int h = 0; h < nirrep_; ++h) {
-#pragma omp parallel for reduction(+ : sum, terms)
+        terms += rowspi_[h] * colspi_[h ^ symmetry_];
+#pragma omp parallel for reduction(+ : sum)
         for (int i = 0; i < rowspi_[h]; ++i) {
             for (int j = 0; j < colspi_[h ^ symmetry_]; ++j) {
                 sum += matrix_[h][i][j] * matrix_[h][i][j];
-                terms++;
             }
         }
     }
