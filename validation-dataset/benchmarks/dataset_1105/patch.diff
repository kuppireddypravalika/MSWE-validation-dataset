From 0f7d0938ceb059b845ac66ff2eb2a8d4deed998f Mon Sep 17 00:00:00 2001
From: Peter Caspers <peter.caspers@acadia.inc>
Date: Wed, 12 Apr 2023 09:26:53 +0200
Subject: [PATCH] QPR-11641 speed up scenario report

---
 OREAnalytics/orea/app/reportwriter.cpp | 5 +----
 1 file changed, 1 insertion(+), 4 deletions(-)

diff --git a/OREAnalytics/orea/app/reportwriter.cpp b/OREAnalytics/orea/app/reportwriter.cpp
index 3f644673f4..f33a733a03 100644
--- a/OREAnalytics/orea/app/reportwriter.cpp
+++ b/OREAnalytics/orea/app/reportwriter.cpp
@@ -1042,12 +1042,9 @@ void ReportWriter::writeScenarioReport(ore::data::Report& report,
     for (const auto& [tradeId, i] : tradeIds) {
 
         Real baseNpv = npvCube->getT0(i);
-        for (Size j = 0; j < scenarioDescriptions.size(); j++) {
+        for (const auto& [j, scenarioNpv] : npvCube->getTradeNPVs(i)) {
             auto scenarioDescription = scenarioDescriptions[j];
-
-            Real scenarioNpv = npvCube->get(i, j);
             Real difference = scenarioNpv - baseNpv;
-
             if (fabs(difference) > outputThreshold) {
                 report.next();
                 report.add(tradeId);
