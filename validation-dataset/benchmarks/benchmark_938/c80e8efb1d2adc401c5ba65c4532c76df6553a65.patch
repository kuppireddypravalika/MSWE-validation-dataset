From c80e8efb1d2adc401c5ba65c4532c76df6553a65 Mon Sep 17 00:00:00 2001
From: Howard Hinnant <hhinnant@apple.com>
Date: Tue, 19 Mar 2013 22:16:57 +0000
Subject: [PATCH] Marshall Clow found this memory problem in strstream using
 -fsanitize=address on the test suite.

---
 libcxx/src/strstream.cpp | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/libcxx/src/strstream.cpp b/libcxx/src/strstream.cpp
index 8cd19e6a353c..518422bd2428 100644
--- a/libcxx/src/strstream.cpp
+++ b/libcxx/src/strstream.cpp
@@ -158,6 +158,8 @@ strstreambuf::overflow(int_type __c)
             return int_type(EOF);
         streamsize old_size = (epptr() ? epptr() : egptr()) - eback();
         streamsize new_size = max<streamsize>(__alsize_, 2*old_size);
+        if (new_size == 0)
+            new_size = __default_alsize;
         char* buf = nullptr;
         if (__palloc_)
             buf = static_cast<char*>(__palloc_(static_cast<size_t>(new_size)));
