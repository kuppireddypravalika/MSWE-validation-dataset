From 9d9c94c4a0a5ab699bc5a0c331f9b3b4f971356a Mon Sep 17 00:00:00 2001
From: Hendrik Leppkes <h.leppkes@gmail.com>
Date: Sat, 17 Mar 2012 19:14:46 +0100
Subject: [PATCH] Slightly optimize data flow in the worker thread

---
 decoder/LAVVideo/DecodeThread.cpp | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/decoder/LAVVideo/DecodeThread.cpp b/decoder/LAVVideo/DecodeThread.cpp
index 457fd83eb..49a567cc4 100644
--- a/decoder/LAVVideo/DecodeThread.cpp
+++ b/decoder/LAVVideo/DecodeThread.cpp
@@ -226,11 +226,11 @@ DWORD CDecodeThread::ThreadProc()
 
   SetThreadName(-1, "LAVVideo Decode Thread");
 
+  HANDLE hWaitEvents[2] = { GetRequestHandle(), m_evInput };
   while(1) {
     if (!bEOS) {
       // Wait for either an input sample, or an request
-      HANDLE hEvents[2] = { GetRequestHandle(), m_evInput };
-      WaitForMultipleObjects(2, hEvents, FALSE, INFINITE);
+      WaitForMultipleObjects(2, hWaitEvents, FALSE, INFINITE);
     }
 
     if (CheckRequest(&cmd)) {
@@ -298,7 +298,7 @@ DWORD CDecodeThread::ThreadProc()
     {
       CAutoLock sampleLock(&m_Samples);
       pSample = m_Samples.Pop();
-      if (!pSample)
+      if (!pSample || m_Samples.Empty())
         m_evInput.Reset();
     }
     if (!pSample) {
