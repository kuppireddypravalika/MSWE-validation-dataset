From fd4ffbb3c7839a80be1c9f468edb13f01ec622d7 Mon Sep 17 00:00:00 2001
From: Frank Warmerdam <warmerdam@pobox.com>
Date: Fri, 18 Nov 2005 17:35:48 +0000
Subject: [PATCH] Use rounding to improve calculation of text parameters in
 DGNCreateTextElem() as per bug:
 http://bugzilla.maptools.org/show_bug.cgi?id=1203

git-svn-id: https://svn.osgeo.org/gdal/trunk@8823 f0d54148-0727-0410-94bb-9a71ac55c965
---
 ogr/ogrsf_frmts/dgn/dgnwrite.cpp | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

diff --git a/ogr/ogrsf_frmts/dgn/dgnwrite.cpp b/ogr/ogrsf_frmts/dgn/dgnwrite.cpp
index 57d6afa539cc..2521299ee6a7 100644
--- a/ogr/ogrsf_frmts/dgn/dgnwrite.cpp
+++ b/ogr/ogrsf_frmts/dgn/dgnwrite.cpp
@@ -28,6 +28,11 @@
  ******************************************************************************
  *
  * $Log$
+ * Revision 1.23  2005/11/18 17:35:48  fwarmerdam
+ * Use rounding to improve calculation of text parameters in
+ * DGNCreateTextElem() as per bug:
+ * http://bugzilla.maptools.org/show_bug.cgi?id=1203
+ *
  * Revision 1.22  2005/11/18 17:16:35  fwarmerdam
  * added TextNode implementation from Ilya Beylin
  *
@@ -1456,10 +1461,10 @@ DGNCreateTextElem( DGNHandle hDGN, const char *pszText,
     psCore->raw_data[36] = (unsigned char) nFontId;
     psCore->raw_data[37] = (unsigned char) nJustification;
 
-    nIntValue = (int) (dfLengthMult * 1000.0 / (psDGN->scale * 6.0));
+    nIntValue = (int) round(dfLengthMult * 1000.0 / (psDGN->scale * 6.0));
     DGN_WRITE_INT32( nIntValue, psCore->raw_data + 38 );
     
-    nIntValue = (int) (dfHeightMult * 1000.0 / (psDGN->scale * 6.0));
+    nIntValue = (int) round(dfHeightMult * 1000.0 / (psDGN->scale * 6.0));
     DGN_WRITE_INT32( nIntValue, psCore->raw_data + 42 );
 
     if( psDGN->dimension == 2 )
