From 142909c3ddb74f236e5c2f4b186d31439dba2fc0 Mon Sep 17 00:00:00 2001
From: Andreas Gal <gal@mozilla.com>
Date: Fri, 11 Dec 2009 16:12:48 -0800
Subject: [PATCH] Avoid slow linear growth of Queues used in the JIT (534168,
 r=dvander).

---
 js/src/jstracer.h | 7 ++++---
 1 file changed, 4 insertions(+), 3 deletions(-)

diff --git a/js/src/jstracer.h b/js/src/jstracer.h
index 04e6ee648bb..8d439de564c 100644
--- a/js/src/jstracer.h
+++ b/js/src/jstracer.h
@@ -66,10 +66,11 @@ class Queue {
 
 public:
     void ensure(unsigned size) {
+        if (_max > size)
+            return;
         if (!_max)
-            _max = 16;
-        while (_max < size)
-            _max <<= 1;
+            _max = 8;
+        _max = JS_MAX(_max * 2, size);
         if (alloc) {
             T* tmp = new (*alloc) T[_max];
             memcpy(tmp, _data, _len * sizeof(T));
