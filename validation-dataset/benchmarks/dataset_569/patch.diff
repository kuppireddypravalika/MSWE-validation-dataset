From 239525e18a543b7f4fe773f99f6c1178708c165b Mon Sep 17 00:00:00 2001
From: CastagnaIT <gottardo.stefano.83@gmail.com>
Date: Sat, 1 Jul 2023 17:24:52 +0200
Subject: [PATCH] [FragmSampleReader] Removed extra memory reserved

---
 src/samplereader/FragmentedSampleReader.cpp | 7 ++-----
 1 file changed, 2 insertions(+), 5 deletions(-)

diff --git a/src/samplereader/FragmentedSampleReader.cpp b/src/samplereader/FragmentedSampleReader.cpp
index 75f32416e..1987c0e5f 100644
--- a/src/samplereader/FragmentedSampleReader.cpp
+++ b/src/samplereader/FragmentedSampleReader.cpp
@@ -154,10 +154,7 @@ AP4_Result CFragmentedSampleReader::ReadSample()
 
     if (m_decrypter)
     {
-      // Make sure that the decrypter is NOT allocating memory!
-      // If decrypter and addon are compiled with different DEBUG / RELEASE
-      // options freeing HEAP memory will fail.
-      m_sampleData.Reserve(m_encrypted.GetDataSize() + 4096);
+      m_sampleData.Reserve(m_encrypted.GetDataSize());
       if (AP4_FAILED(result =
                          m_decrypter->DecryptSampleData(m_poolId, m_encrypted, m_sampleData, NULL)))
       {
@@ -179,7 +176,7 @@ AP4_Result CFragmentedSampleReader::ReadSample()
     }
     else if (useDecryptingDecoder)
     {
-      m_sampleData.Reserve(m_encrypted.GetDataSize() + 1024);
+      m_sampleData.Reserve(m_encrypted.GetDataSize());
       m_singleSampleDecryptor->DecryptSampleData(m_poolId, m_encrypted, m_sampleData, nullptr, 0,
                                                  nullptr, nullptr);
     }
