From 61a1df6e57d6577d26edcdaa47522e6138dbaf69 Mon Sep 17 00:00:00 2001
From: Soonho Kong <soonho.kong@tri.global>
Date: Mon, 27 Feb 2017 20:36:25 -0500
Subject: [PATCH] Use ToSymbolic instead of DoToSymbolic in MakeSparsityMatrix

Fixes memory-leak.
---
 drake/systems/framework/leaf_system.h | 8 +++++---
 1 file changed, 5 insertions(+), 3 deletions(-)

diff --git a/drake/systems/framework/leaf_system.h b/drake/systems/framework/leaf_system.h
index 8a1f2cd81b63..d258130927e1 100644
--- a/drake/systems/framework/leaf_system.h
+++ b/drake/systems/framework/leaf_system.h
@@ -516,11 +516,13 @@ class LeafSystem : public System<T> {
   /// Returns a SparsityMatrix for this system, or nullptr if a SparsityMatrix
   /// cannot be constructed because this System has no symbolic representation.
   std::unique_ptr<SparsityMatrix> MakeSparsityMatrix() const {
-    auto symbolic_system = this->DoToSymbolic();
-    if (symbolic_system == nullptr) {
+    std::unique_ptr<System<symbolic::Expression>> symbolic_system =
+        this->ToSymbolic();
+    if (symbolic_system) {
+      return std::make_unique<SparsityMatrix>(*symbolic_system);
+    } else {
       return nullptr;
     }
-    return std::make_unique<SparsityMatrix>(*symbolic_system);
   }
 
   // Periodic Update or Publish events registered on this system.
