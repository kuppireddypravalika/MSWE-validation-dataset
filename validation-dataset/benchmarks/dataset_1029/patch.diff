From 56027b963fa6f68c1ceceed709ad0226988ac4bc Mon Sep 17 00:00:00 2001
From: Tormod Landet <tormod@landet.net>
Date: Wed, 30 Sep 2015 19:08:19 +0200
Subject: [PATCH] Make sure local tensor is always set to zero on empty dx
 integral

---
 dolfin/fem/LocalAssembler.cpp | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/dolfin/fem/LocalAssembler.cpp b/dolfin/fem/LocalAssembler.cpp
index 83e7b69277b..ae4a55fba7a 100644
--- a/dolfin/fem/LocalAssembler.cpp
+++ b/dolfin/fem/LocalAssembler.cpp
@@ -120,7 +120,11 @@ LocalAssembler::assemble_cell(Eigen::Matrix<double, Eigen::Dynamic,
 
   // Skip integral if zero
   if (!integral)
+  {
+    // Clear tensor here instead of in assemble() as a small speedup
+    A.setZero();
     return;
+  }
 
   // Update to current cell
   ufc.update(cell, coordinate_dofs, ufc_cell,
