From 13553a59905e4b55d3928242e77b769a885ed171 Mon Sep 17 00:00:00 2001
From: Jay Foad <jay.foad@amd.com>
Date: Wed, 1 Dec 2021 14:45:18 +0000
Subject: [PATCH] Set NoSignedZeros regardless of NoContraction decoration

There is no reason for the SPIR-V NoContraction decoration to prevent us
from setting the LLVM NoSignedZeros fast math flag on an instruction.
Setting NoSignedZeros in more cases allows more optimizations like
0.0 * x --> 0.0 (assuming we have already set the NoNaNs flag).
---
 llpc/translator/lib/SPIRV/SPIRVReader.cpp | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/llpc/translator/lib/SPIRV/SPIRVReader.cpp b/llpc/translator/lib/SPIRV/SPIRVReader.cpp
index 3faa7bd40b..a59ea84039 100644
--- a/llpc/translator/lib/SPIRV/SPIRVReader.cpp
+++ b/llpc/translator/lib/SPIRV/SPIRVReader.cpp
@@ -1029,7 +1029,7 @@ FastMathFlags SPIRVToLLVM::getFastMathFlags(SPIRVValue *bv) {
     if (!m_moduleUsage->useIsNan)
       fmf.setNoNaNs();
 
-    fmf.setNoSignedZeros(allowContract);
+    fmf.setNoSignedZeros();
   }
   return fmf;
 }
