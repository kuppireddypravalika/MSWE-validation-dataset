From 79047dcfc1733749f1a08e6758bb8df63bfe5ec0 Mon Sep 17 00:00:00 2001
From: Lukas Rusak <lorusak@gmail.com>
Date: Mon, 19 Apr 2021 17:13:52 -0700
Subject: [PATCH] CTimeUtils: convert to std::chrono

---
 xbmc/utils/TimeUtils.cpp | 13 ++++++++++---
 1 file changed, 10 insertions(+), 3 deletions(-)

diff --git a/xbmc/utils/TimeUtils.cpp b/xbmc/utils/TimeUtils.cpp
index 6f1666cab7a45..95c5069c11605 100644
--- a/xbmc/utils/TimeUtils.cpp
+++ b/xbmc/utils/TimeUtils.cpp
@@ -8,7 +8,6 @@
 
 #include "TimeUtils.h"
 #include "XBDateTime.h"
-#include "threads/SystemClock.h"
 #include "windowing/GraphicContext.h"
 
 #if   defined(TARGET_DARWIN)
@@ -20,6 +19,11 @@
 #include <time.h>
 #endif
 
+namespace
+{
+auto startTime = std::chrono::steady_clock::now();
+}
+
 int64_t CurrentHostCounter(void)
 {
 #if defined(TARGET_DARWIN)
@@ -52,11 +56,14 @@ int64_t CurrentHostFrequency(void)
 #endif
 }
 
-unsigned int CTimeUtils::frameTime = XbmcThreads::SystemClockMillis();
+unsigned int CTimeUtils::frameTime = 0;
 
 void CTimeUtils::UpdateFrameTime(bool flip)
 {
-  unsigned int currentTime = XbmcThreads::SystemClockMillis();
+  auto now = std::chrono::steady_clock::now();
+  auto duration = std::chrono::duration_cast<std::chrono::milliseconds>(now - startTime);
+
+  unsigned int currentTime = duration.count();
   unsigned int last = frameTime;
   while (frameTime < currentTime)
   {
