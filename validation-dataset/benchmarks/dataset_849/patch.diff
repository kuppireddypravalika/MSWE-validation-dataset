From 4029d2cf5b3ec6a7bec31a691fb2b97c0fe51974 Mon Sep 17 00:00:00 2001
From: David Korth <gerbilsoft@gerbilsoft.com>
Date: Sun, 21 May 2017 21:32:03 -0400
Subject: [PATCH] [libromdata] Nintendo3DSFirm: Check firmBuf for sighax
 installer instead of reading from the file again.

---
 src/libromdata/Nintendo3DSFirm.cpp | 14 ++++----------
 1 file changed, 4 insertions(+), 10 deletions(-)

diff --git a/src/libromdata/Nintendo3DSFirm.cpp b/src/libromdata/Nintendo3DSFirm.cpp
index 4cf1e226cc..d0d6344b9c 100644
--- a/src/libromdata/Nintendo3DSFirm.cpp
+++ b/src/libromdata/Nintendo3DSFirm.cpp
@@ -299,19 +299,13 @@ int Nintendo3DSFirm::loadFieldData(void)
 		if (!memcmp(&firmHeader->reserved[0x2D], "B9S", 3)) {
 			// This is Boot9Strap.
 			firmBinDesc = _RP("Boot9Strap");
-		} else {
+		} else if (firmBuf) {
 			// Check for sighax installer.
 			// NOTE: String has a NULL terminator.
 			static const char sighax_magic[] = "3DS BOOTHAX INS";
-			d->file->rewind();
-			int ret = d->file->seek(0x208);
-			if (ret == 0) {
-				char buf[sizeof(sighax_magic)];
-				size_t size = d->file->read(buf, sizeof(buf));
-				if (size == sizeof(buf) && !memcmp(buf, sighax_magic, sizeof(buf))) {
-					// Found derrek's sighax installer.
-					firmBinDesc = _RP("sighax installer");
-				}
+			if (!memcmp(&firmBuf[0x208], sighax_magic, sizeof(sighax_magic))) {
+				// Found derrek's sighax installer.
+				firmBinDesc = _RP("sighax installer");
 			}
 		}
 	}
