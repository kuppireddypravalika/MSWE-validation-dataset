From 814a2a6a34fce2a1e4bce8fe45c512c498338c1c Mon Sep 17 00:00:00 2001
From: elsid <elsid@yandex-team.ru>
Date: Sat, 9 Apr 2016 17:23:59 +0300
Subject: [PATCH] Unlock before async call when pool is disabled

To reduce critical section size.

Change-Id: I7fc0c2906b7d6f741b6376f0a539e2faab7c27af
---
 include/yamail/resource_pool/async/detail/pool_impl.hpp | 1 +
 1 file changed, 1 insertion(+)

diff --git a/include/yamail/resource_pool/async/detail/pool_impl.hpp b/include/yamail/resource_pool/async/detail/pool_impl.hpp
index bd3148d..2e122ef 100644
--- a/include/yamail/resource_pool/async/detail/pool_impl.hpp
+++ b/include/yamail/resource_pool/async/detail/pool_impl.hpp
@@ -130,6 +130,7 @@ template <class V, class I, class T>
 void pool_impl<V, I, T>::get(callback call, const time_duration& wait_duration) {
     unique_lock lock(_mutex);
     if (_disabled) {
+        lock.unlock();
         async_call(bind(call, make_error_code(error::disabled), list_iterator()));
     } else if (!_available.empty()) {
         alloc_resource(lock, call);
