From 69790e925c77f36f96655017a16f6827f37ed831 Mon Sep 17 00:00:00 2001
From: Harald Lang <harald.lang@in.tum.de>
Date: Fri, 11 Oct 2019 14:00:17 +0200
Subject: [PATCH] fix skip_to(pos) in bitwise-op iterator (not yet efficient)

---
 src/dtl/bitmap/bitwise_operations.hpp | 15 +++++++++++++--
 1 file changed, 13 insertions(+), 2 deletions(-)

diff --git a/src/dtl/bitmap/bitwise_operations.hpp b/src/dtl/bitmap/bitwise_operations.hpp
index 45ef597f..160145cb 100644
--- a/src/dtl/bitmap/bitwise_operations.hpp
+++ b/src/dtl/bitmap/bitwise_operations.hpp
@@ -269,8 +269,19 @@ class bitwise_iter {
 
   void __forceinline__
   skip_to(const std::size_t to_pos) noexcept {
-    it_a_.skip_to(to_pos);
-    it_b_.skip_to(to_pos);
+    if (to_pos < (pos_ + length_)) {
+      length_ -= to_pos - pos_;
+      pos_ = to_pos;
+      return;
+    }
+    // TODO: implement efficient skip support
+    while (!end() && (pos_ + length_) <= to_pos) {
+      operation::next(it_a_, it_b_, pos_, length_);
+    }
+    if (!end() && to_pos > pos_) {
+      length_ -= to_pos - pos_;
+      pos_ = to_pos;
+    }
   }
 
   /// Returns true if the iterator reached the end, false otherwise.
