From 01f9f73708884e334006dbc3b35db75bdd66bde4 Mon Sep 17 00:00:00 2001
From: Martin Pecka <peci1@seznam.cz>
Date: Wed, 25 May 2016 17:10:43 +0200
Subject: [PATCH] More efficient image buffer copy

---
 src/optris_colorconvert_node.cpp | 9 ++++-----
 1 file changed, 4 insertions(+), 5 deletions(-)

diff --git a/src/optris_colorconvert_node.cpp b/src/optris_colorconvert_node.cpp
index 660680c..21cc1d9 100644
--- a/src/optris_colorconvert_node.cpp
+++ b/src/optris_colorconvert_node.cpp
@@ -77,14 +77,13 @@ void onThermalDataReceive(const sensor_msgs::ImageConstPtr& image)
   img.width 	        = image->width;
   img.encoding        = "rgb8";
   img.step            = image->width*3;
-  img.data.resize(img.height*img.step);
   img.header.seq      = ++_frame;
   img.header.stamp    = ros::Time::now();
 
-  for(unsigned int i=0; i<image->width*image->height*3; i++) {
-    img.data[i] = _bufferThermal[i];
-  }
-
+  // copy the image buffer
+  img.data.resize(img.height*img.step);
+  memcpy(&img.data[0], &_bufferThermal[0], img.height * img.step * sizeof(*_bufferThermal));
+  
   _camera_info = _camera_info_manager->getCameraInfo();
   _camera_info.header = img.header;
   _camera_info_pub->publish(img, _camera_info);
