From f566d61cbf59133dbad65ea5a9ef35c2b454a9db Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Martin=20Jon=C3=A1=C5=A1?= <martin.jonas@mail.muni.cz>
Date: Wed, 25 Jul 2018 12:41:13 +0200
Subject: [PATCH] Simplifier: cache results of ReduceDivRem.

---
 lib/ExprSimplifier.cpp | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/lib/ExprSimplifier.cpp b/lib/ExprSimplifier.cpp
index 5eb40c5..af9f43d 100644
--- a/lib/ExprSimplifier.cpp
+++ b/lib/ExprSimplifier.cpp
@@ -1063,6 +1063,12 @@ z3::expr ExprSimplifier::EliminatePureLiterals(z3::expr &e)
 
 expr ExprSimplifier::ReduceDivRem(const expr &e)
 {
+    auto item = reduceDivRemCache.find((Z3_ast)e);
+    if (item != reduceDivRemCache.end())
+    {
+	return item->second;
+    }
+
     if (e.is_app())
     {
 	func_decl dec = e.decl();
@@ -1101,6 +1107,7 @@ expr ExprSimplifier::ReduceDivRem(const expr &e)
         }
 
 	expr result = dec(arguments);
+        reduceDivRemCache.insert({e, result});
 	return result;
     }
     else if (e.is_quantifier())
