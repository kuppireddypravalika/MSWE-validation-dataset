From 8561901d322d5fa0b6e89a48232c2f9e569b9cff Mon Sep 17 00:00:00 2001
From: rp9-next <103115900+rp9-next@users.noreply.github.com>
Date: Fri, 11 Nov 2022 17:55:45 +0530
Subject: [PATCH] MSFT-PATCH: Don't use the extended ICU data for Windows OS
 ICU.

For the Windows OS build of ICU, we only have one data file
and we don't use the extended data at all. We make this function a no-op
in order to save a few cycles for perf, but more importantly so that
we don't try to load a versioned data file (ex: icudt68l.dat) after
already loading the non-versioned common data file.
---
 icu/icu4c/source/common/udata.cpp | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/icu/icu4c/source/common/udata.cpp b/icu/icu4c/source/common/udata.cpp
index 2bc74c9789..323555d6ad 100644
--- a/icu/icu4c/source/common/udata.cpp
+++ b/icu/icu4c/source/common/udata.cpp
@@ -820,6 +820,16 @@ openCommonData(const char *path,          /*  Path from OpenChoice?          */
  *----------------------------------------------------------------------*/
 static UBool extendICUData(UErrorCode *pErr)
 {
+// MSFT-Change: For the Windows OS build of ICU, we only have one data file
+// and we don't use the extended data at all. We make this function a no-op
+// in order to save a few cycles for perf, but more importantly so that
+// we don't try to load a versioned data file (ex: icudt68l.dat) after
+// already loading the non-versioned common data file.
+#if defined(ICU_DATA_DIR_WINDOWS)
+    (void)pErr; // suppress unused variable.
+    return false;
+#endif
+
     UDataMemory   *pData;
     UDataMemory   copyPData;
     UBool         didUpdate = false;
