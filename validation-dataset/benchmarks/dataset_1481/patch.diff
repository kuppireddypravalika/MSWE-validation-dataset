From 9e97560209795028f463384201996437c9bc38c6 Mon Sep 17 00:00:00 2001
From: Titus Cieslewski <dev@titus-c.ch>
Date: Sun, 27 Jul 2014 15:23:53 +0200
Subject: [PATCH] Small optimization that already does a lot in reducing update
 time, even with linked.

---
 aslam_map_manager/map_api/src/cru-table.cc | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/aslam_map_manager/map_api/src/cru-table.cc b/aslam_map_manager/map_api/src/cru-table.cc
index 5491c89b..ba7ce6a8 100644
--- a/aslam_map_manager/map_api/src/cru-table.cc
+++ b/aslam_map_manager/map_api/src/cru-table.cc
@@ -14,6 +14,9 @@
 #include "map-api/local-transaction.h"
 #include "core.pb.h"
 
+DEFINE_bool(cru_linked, false, "Determines whether a revision has references "\
+            "to the previous and next revision.");
+
 namespace map_api {
 
 CRUTable::~CRUTable() {}
@@ -31,7 +34,7 @@ bool CRUTable::update(Revision* query) {
   query->get(kInsertTimeField, &insert_time);
   CHECK(current->verify(kInsertTimeField, insert_time));
   LogicalTime previous_time, update_time = LogicalTime::sample();
-  getLatestUpdateTime(id, &previous_time);
+  current->get(kPreviousTimeField, &previous_time);
   CHECK(previous_time < update_time);
   query->set(kPreviousTimeField, previous_time);
   query->set(kUpdateTimeField, update_time);
