From 12d4a2da9a7008bf5c809f221d78eef2b2aea667 Mon Sep 17 00:00:00 2001
From: datajake1999 <datajake@gmail.com>
Date: Tue, 23 Feb 2021 03:47:57 -0800
Subject: [PATCH] Optimized building of MIDI messages sent to midi_write.

---
 src/OPL3GM_proc.cpp | 9 ++++-----
 1 file changed, 4 insertions(+), 5 deletions(-)

diff --git a/src/OPL3GM_proc.cpp b/src/OPL3GM_proc.cpp
index 7517249..59b36de 100644
--- a/src/OPL3GM_proc.cpp
+++ b/src/OPL3GM_proc.cpp
@@ -63,13 +63,12 @@ VstInt32 OPL3GM::processEvents (VstEvents* ev)
 		if ((ev->events[i])->type == kVstMidiType)
 		{
 			VstMidiEvent* event = (VstMidiEvent*)ev->events[i];
-			unsigned int byte1 = event->midiData[0] & 0xFF;
-			unsigned int byte2 = event->midiData[1] & 0x7F;
-			unsigned int byte3 = event->midiData[2] & 0x7F;
-			unsigned int msg = (byte3<<16) | (byte2<<8) | byte1;
+			unsigned char byte1 = event->midiData[0] & 0xFF;
+			unsigned char byte2 = event->midiData[1] & 0x7F;
+			unsigned char byte3 = event->midiData[2] & 0x7F;
 			if (synth)
 			{
-				synth->midi_write(msg);
+				synth->midi_write((byte3<<16) | (byte2<<8) | byte1);
 			}
 		}
 	}
