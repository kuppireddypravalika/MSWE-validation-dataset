From 9863955122f286c4f1801aeb565393384e89fb94 Mon Sep 17 00:00:00 2001
From: Erik Garrison <erik.garrison@gmail.com>
Date: Sun, 6 Mar 2022 09:39:32 +0100
Subject: [PATCH] only do pure WFA on things that are really low div (99% id)
 and 20kb

---
 src/common/wflign/src/wflign_wfa.cpp | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/src/common/wflign/src/wflign_wfa.cpp b/src/common/wflign/src/wflign_wfa.cpp
index eeaa809a..81ef9b74 100644
--- a/src/common/wflign/src/wflign_wfa.cpp
+++ b/src/common/wflign/src/wflign_wfa.cpp
@@ -19,7 +19,7 @@ namespace wflign {
 
 namespace wavefront {
 
-#define MAX_LEN_FOR_PURE_WFA    50000 // only for low-divergence, otherwise disabled
+#define MAX_LEN_FOR_PURE_WFA    20000 // only for low-divergence, otherwise disabled
 #define MIN_WF_LENGTH           256
 #define MAX_DIST_THRESHOLD      256
 
@@ -246,7 +246,7 @@ void wflign_affine_wavefront(
 
     // if we expect the alignment to be low divergence, and the mapping is less than 50kb
     // it's faster to just align directly with WFA
-    if (mashmap_estimated_identity >= 0.95 // about the limit of what our reduction thresholds allow
+    if (mashmap_estimated_identity >= 0.99 // about the limit of what our reduction thresholds allow
         && query_length <= MAX_LEN_FOR_PURE_WFA && target_length <= MAX_LEN_FOR_PURE_WFA) {
         wfa::wavefront_aligner_t* const wf_aligner = get_wavefront_aligner(wfa_affine_penalties,
                                                                            target_length,
