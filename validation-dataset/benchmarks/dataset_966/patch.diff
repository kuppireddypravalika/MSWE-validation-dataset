From 4c8bd65057cd51bbe3fb81f0e62ab68ef1741eb3 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Marco=20Trevisan=20=28Trevi=C3=B1o=29?= <mail@3v1n0.net>
Date: Wed, 29 Jun 2022 16:48:37 +0200
Subject: [PATCH] cairo-context: Use GjsAutoCppPointer of doubles instead of
 vector

---
 modules/cairo-context.cpp | 12 +++++++-----
 1 file changed, 7 insertions(+), 5 deletions(-)

diff --git a/modules/cairo-context.cpp b/modules/cairo-context.cpp
index b777fb293..0d0f76511 100644
--- a/modules/cairo-context.cpp
+++ b/modules/cairo-context.cpp
@@ -4,7 +4,9 @@
 
 #include <config.h>
 
-#include <vector>
+#include <stddef.h>  // for size_t
+
+#include <memory>
 
 #include <cairo.h>
 #include <girepository.h>
@@ -518,8 +520,8 @@ setDash_func(JSContext *context,
         return false;
     }
 
-    std::vector<double> dashes_c;
-    dashes_c.reserve(len);
+    std::unique_ptr<double[]> dashes_c = std::make_unique<double[]>(len);
+    size_t dashes_c_size = 0;
     JS::RootedValue elem(context);
     for (i = 0; i < len; ++i) {
         double b;
@@ -538,10 +540,10 @@ setDash_func(JSContext *context,
             return false;
         }
 
-        dashes_c.push_back(b);
+        dashes_c[dashes_c_size++] = b;
     }
 
-    cairo_set_dash(cr, dashes_c.data(), dashes_c.size(), offset);
+    cairo_set_dash(cr, dashes_c.get(), dashes_c_size, offset);
     argv.rval().setUndefined();
     return true;
 }
