From bed06572720cb36d16b43dd9350f10137834074a Mon Sep 17 00:00:00 2001
From: domschrei <mail@dominikschreiber.de>
Date: Wed, 2 Sep 2020 14:56:30 +0200
Subject: [PATCH] Improve bad USignatureHasher which lead to robin_hood::map
 overflow

---
 src/data/signature.h | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/src/data/signature.h b/src/data/signature.h
index 7ba3108..3a1ae57 100644
--- a/src/data/signature.h
+++ b/src/data/signature.h
@@ -89,15 +89,19 @@ struct Signature {
 struct USignatureHasher {
     inline std::size_t operator()(const USignature& s) const {
         size_t hash = s._args.size();
+        int sum = hash;
         for (const int& arg : s._args) {
             hash_combine(hash, arg);
+            sum += arg;
         }
         hash_combine(hash, s._name_id);
+        sum += s._name_id;
+        hash_combine(hash, sum);
         return hash;
     }
 };
 struct SignatureHasher {
-    static USignatureHasher _usig_hasher;
+    USignatureHasher _usig_hasher;
     inline std::size_t operator()(const Signature& s) const {
         size_t hash = _usig_hasher(s._usig);
         hash_combine(hash, s._negated);
