From efded72e9b49dc63ffe10351c7a985441a6956cc Mon Sep 17 00:00:00 2001
From: Axel Naumann <Axel.Naumann@cern.ch>
Date: Thu, 6 Dec 2012 13:50:11 +0000
Subject: [PATCH] Possibly speed up dlsym by looking at the global linker map
 instead of iterating over all libraries ourselves.

git-svn-id: http://root.cern.ch/svn/root/trunk@47892 27541ba8-7e3a-0410-8455-c3a389f83636
---
 interpreter/llvm/src/lib/Support/DynamicLibrary.cpp | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/interpreter/llvm/src/lib/Support/DynamicLibrary.cpp b/interpreter/llvm/src/lib/Support/DynamicLibrary.cpp
index 45fec361c1a6c..4e05ecfbe73e7 100644
--- a/interpreter/llvm/src/lib/Support/DynamicLibrary.cpp
+++ b/interpreter/llvm/src/lib/Support/DynamicLibrary.cpp
@@ -137,6 +137,10 @@ void* DynamicLibrary::SearchForAddressOfSymbol(const char *symbolName) {
   }
 
 #if HAVE_DLFCN_H
+  void* ptr = dlsym(RTLD_DEFAULT, symbolName);
+  if (ptr)
+    return ptr;
+#ifdef R__TOO_SLOW
   // Now search the libraries.
   if (OpenedHandles) {
     for (DenseSet<void *>::iterator I = OpenedHandles->begin(),
@@ -148,6 +152,7 @@ void* DynamicLibrary::SearchForAddressOfSymbol(const char *symbolName) {
       }
     }
   }
+#endif // R__TOO_SLOW
 #endif
 
   if (void *Result = llvm::SearchForAddressOfSpecialSymbol(symbolName))
