From f28a392f71c927fb8171be7adfa216743c4c640d Mon Sep 17 00:00:00 2001
From: KayenEQ <kayen85@gmail.com>
Date: Sun, 22 Jun 2014 15:55:04 -0400
Subject: [PATCH] SE_NegateAttacks buff stacking optimized.

---
 zone/bonuses.cpp | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/zone/bonuses.cpp b/zone/bonuses.cpp
index ffb13edd8a..481ec668ab 100644
--- a/zone/bonuses.cpp
+++ b/zone/bonuses.cpp
@@ -2291,7 +2291,8 @@ void Mob::ApplySpellsBonuses(uint16 spell_id, uint8 casterlevel, StatBonuses* ne
 
 			case SE_NegateAttacks:
 			{
-				if (!newbon->NegateAttacks[0]){
+				if (!newbon->NegateAttacks[0] || 
+					((newbon->NegateAttacks[0] && newbon->NegateAttacks[2]) && (newbon->NegateAttacks[2] < max))){
 					newbon->NegateAttacks[0] = 1;
 					newbon->NegateAttacks[1] = buffslot;
 					newbon->NegateAttacks[2] = max;
