From f3d5d8b676d6a26c30bcc2f0d78cd826c512e7a9 Mon Sep 17 00:00:00 2001
From: Even Rouault <even.rouault@mines-paris.org>
Date: Tue, 21 Jul 2015 13:47:11 +0000
Subject: [PATCH] Pansharpen: tiny optimization/simplification of SSE2 code

git-svn-id: https://svn.osgeo.org/gdal/trunk@29551 f0d54148-0727-0410-94bb-9a71ac55c965
---
 gdal/alg/gdalpansharpen.cpp | 5 ++---
 1 file changed, 2 insertions(+), 3 deletions(-)

diff --git a/gdal/alg/gdalpansharpen.cpp b/gdal/alg/gdalpansharpen.cpp
index 778d2466eac2..b50c8db9eb6c 100644
--- a/gdal/alg/gdalpansharpen.cpp
+++ b/gdal/alg/gdalpansharpen.cpp
@@ -496,9 +496,8 @@ void GDALPansharpenOperation::WeightedBroveyPositiveWeightsInternal(
             XMMReg2Double rawValue = XMMReg2Double::Load2Val(pUpsampledSpectralBuffer + i * nValues + j);
             XMMReg2Double tmp = XMMReg2Double::Min(rawValue * factor, maxValue);
             __m128i tmp2 = _mm_cvtpd_epi32(tmp.xmm); /* Convert the 2 double values to 2 integers */
-            tmp2 =  _mm_shufflelo_epi16(tmp2,  _MM_SHUFFLE(0, 0, 2, 0)); /* Pack the 2 integers as 2 shorts */
-            pDataBuf[i * nValues + j] = _mm_extract_epi16(tmp2, 0);
-            pDataBuf[i * nValues + j + 1] = _mm_extract_epi16(tmp2, 1);
+            pDataBuf[i * nValues + j] = (GUInt16)_mm_extract_epi16(tmp2, 0);
+            pDataBuf[i * nValues + j + 1] = (GUInt16)_mm_extract_epi16(tmp2, 2);
         }
     }
 }
