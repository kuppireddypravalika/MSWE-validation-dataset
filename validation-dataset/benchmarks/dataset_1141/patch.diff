From 8ec14cb65c5a62746126997ff3ec6134c4ef4362 Mon Sep 17 00:00:00 2001
From: Frank Warmerdam <warmerdam@pobox.com>
Date: Fri, 24 Sep 2004 02:48:39 +0000
Subject: [PATCH] Try to avoid unnecessary calls to TIFFReadDirectory() when
 scanning for overviews in files with only one directory.

git-svn-id: https://svn.osgeo.org/gdal/trunk@6577 f0d54148-0727-0410-94bb-9a71ac55c965
---
 frmts/gtiff/geotiff.cpp | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/frmts/gtiff/geotiff.cpp b/frmts/gtiff/geotiff.cpp
index 7d2d1348f700..c27fc7113c2f 100644
--- a/frmts/gtiff/geotiff.cpp
+++ b/frmts/gtiff/geotiff.cpp
@@ -28,6 +28,10 @@
  ******************************************************************************
  *
  * $Log$
+ * Revision 1.115  2004/09/24 02:48:39  fwarmerdam
+ * Try to avoid unnecessary calls to TIFFReadDirectory() when scanning
+ * for overviews in files with only one directory.
+ *
  * Revision 1.114  2004/09/08 15:33:18  warmerda
  * allow writing of projection without geotrasnform
  *
@@ -2570,7 +2574,8 @@ CPLErr GTiffDataset::OpenOffset( TIFF *hTIFFIn, uint32 nDirOffsetIn,
 /* -------------------------------------------------------------------- */
     if( bBase )
     {
-        while( TIFFReadDirectory( hTIFF ) != 0 )
+        while( !TIFFLastDirectory( hTIFF ) 
+               && TIFFReadDirectory( hTIFF ) != 0 )
         {
             uint32	nThisDir = TIFFCurrentDirOffset(hTIFF);
             uint32	nSubType;
