From 6b9b113b3e83e4298fb4b62ed170b9d94d9b2007 Mon Sep 17 00:00:00 2001
From: Jean-Yves Avenard <jyavenard@mythtv.org>
Date: Wed, 18 Jun 2014 22:31:15 +1000
Subject: [PATCH] =?UTF-8?q?Stop=20readahead=20thread=20if=20the=20file=20i?=
 =?UTF-8?q?sn=E2=80=99t=20opened.?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

No point trying to read from the file when thereâ€™s nothing to read
---
 mythtv/libs/libmythtv/ringbuffer.cpp | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/mythtv/libs/libmythtv/ringbuffer.cpp b/mythtv/libs/libmythtv/ringbuffer.cpp
index f1d9c547bed..6706ce67f40 100644
--- a/mythtv/libs/libmythtv/ringbuffer.cpp
+++ b/mythtv/libs/libmythtv/ringbuffer.cpp
@@ -908,6 +908,13 @@ void RingBuffer::run(void)
 
     while (readaheadrunning)
     {
+        if (!IsOpen())
+        {
+            poslock.lockForWrite();
+            readaheadrunning = false;
+            generalWait.wakeAll();
+            poslock.unlock();
+        }
         if (PauseAndWait())
         {
             ignore_for_read_timing = true;
