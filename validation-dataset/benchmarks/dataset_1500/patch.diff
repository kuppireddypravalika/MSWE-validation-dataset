From 6c76f19bc24b2304616aca7f77c4123542403456 Mon Sep 17 00:00:00 2001
From: "bernard.parisse" <bernard.parisse@23ce0884-8a58-47d3-bc5c-ddf1cd5b9f9e>
Date: Wed, 3 Mar 2021 19:51:14 +0000
Subject: [PATCH] [giac] attempt to improve solve on linear systems with 2
 unknowns

git-svn-id: https://dev.geogebra.org/svn/trunk/geogebra/giac@69741 23ce0884-8a58-47d3-bc5c-ddf1cd5b9f9e
---
 src/giac/cpp/solve.cc | 18 +++++++++++++++++-
 1 file changed, 17 insertions(+), 1 deletion(-)

diff --git a/src/giac/cpp/solve.cc b/src/giac/cpp/solve.cc
index d6cc80fe..1e7efa85 100644
--- a/src/giac/cpp/solve.cc
+++ b/src/giac/cpp/solve.cc
@@ -4198,7 +4198,23 @@ namespace giac {
     A=sxa(sl,x,contextptr);
     vecteur B,R(x);
     gen rep;
-    B=mrref(A,contextptr);
+    if (A.size()==2 && x.size()==2){
+      gen a00=A[0][0];
+      if (is_zero(a00,contextptr))
+	B=makevecteur(A[1],A[0]);
+      else 
+	B=makevecteur(A[0],subvecteur(multvecteur(a00,*A[1]._VECTptr),multvecteur(A[1][0],*A[0]._VECTptr)));
+      B[1]._VECTptr->front()=0;
+      gen b11=(*B[1]._VECTptr)[1];
+      b11=simplify(b11,contextptr);
+      (*B[1]._VECTptr)[1]=b11;
+      if (!is_zero(b11)){
+	B=makevecteur(subvecteur(multvecteur(b11,*B[0]._VECTptr),multvecteur(B[0][1],*B[1]._VECTptr)),B[1]);
+	(*B[0]._VECTptr)[1]=0;
+      }
+    }
+    else
+      B=mrref(A,contextptr);
     //COUT<<B<<'\n';
     int d=int(x.size());
     int de=int(sl.size());
