From 813f7b50c14ea02e511fed5d0534a74ffa3630e8 Mon Sep 17 00:00:00 2001
From: Malcolm Jestadt <MalcolmJestadt@gmail.com>
Date: Sat, 21 Jan 2023 11:40:18 -0500
Subject: [PATCH] SPU LLVM: Minor SUMB AVX-512 path optimization - Tweak
 shuffle to allow LLVM to emit a cheap blend instruction instead of the
 expensive VPERMI2W instruction

---
 rpcs3/Emu/Cell/SPURecompiler.cpp | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/rpcs3/Emu/Cell/SPURecompiler.cpp b/rpcs3/Emu/Cell/SPURecompiler.cpp
index c560b576a23f..7e9cadb2d7a9 100644
--- a/rpcs3/Emu/Cell/SPURecompiler.cpp
+++ b/rpcs3/Emu/Cell/SPURecompiler.cpp
@@ -7709,7 +7709,7 @@ class spu_llvm_recompiler : public spu_recompiler_base, public cpu_translator
 
 			const auto ax = vdbpsadbw(a, zeroes, 0);
 			const auto bx = vdbpsadbw(b, zeroes, 0);
-			set_vr(op.rt, shuffle2(ax, bx, 0, 8, 2, 10, 4, 12, 6, 14));
+			set_vr(op.rt, shuffle2(ax, bx, 0, 9, 2, 11, 4, 13, 6, 15));
 			return;
 		}
 
