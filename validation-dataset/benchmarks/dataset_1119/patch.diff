From f7c51e684ac96f8b7a2a964545dc95672de29d41 Mon Sep 17 00:00:00 2001
From: Even Rouault <even.rouault@mines-paris.org>
Date: Thu, 11 Dec 2014 13:39:55 +0000
Subject: [PATCH] RasterIO resampling: operate on the full width of a raster
 whose block width is the raster width, prefer doing chunks in height

git-svn-id: https://svn.osgeo.org/gdal/trunk@28126 f0d54148-0727-0410-94bb-9a71ac55c965
---
 gdal/gcore/rasterio.cpp | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/gdal/gcore/rasterio.cpp b/gdal/gcore/rasterio.cpp
index 4a200d3bdb39..5511f1b1d5e6 100644
--- a/gdal/gcore/rasterio.cpp
+++ b/gdal/gcore/rasterio.cpp
@@ -895,7 +895,12 @@ CPLErr GDALRasterBand::RasterIOResampled( GDALRWFlag eRWFlag,
             if( (nDstBlockXSize == 1 && nDstBlockYSize == 1) ||
                 ((GIntBig)nFullResXChunk * nFullResYChunk <= 1024 * 1024) )
                 break;
-            if( nDstBlockXSize > 1 && nFullResXChunk > nFullResYChunk )
+            /* When operating on the full width of a raster whose block width is */
+            /* the raster width, prefer doing chunks in height */
+            if( nFullResXChunk >= nXSize && nXSize == nBlockXSize && nDstBlockYSize > 1 )
+                nDstBlockYSize /= 2;
+            /* Otherwise cut the maximal dimension */
+            else if( nDstBlockXSize > 1 && nFullResXChunk > nFullResYChunk )
                 nDstBlockXSize /= 2;
             else
                 nDstBlockYSize /= 2;
