From 3031c43765fdae40dbd20e49e02cbc55edc57b59 Mon Sep 17 00:00:00 2001
From: "Herholz, Sebastian" <sebastian.herholz@intel.com>
Date: Wed, 29 May 2024 16:40:17 +0200
Subject: [PATCH] [pathsegment] Lowering the minPDF threshold (0.1 -> 0.01) to
 get more accurate radiance cache approaximations.

---
 openpgl/data/PathSegmentDataStorage.h | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/openpgl/data/PathSegmentDataStorage.h b/openpgl/data/PathSegmentDataStorage.h
index f403893..57c74ef 100644
--- a/openpgl/data/PathSegmentDataStorage.h
+++ b/openpgl/data/PathSegmentDataStorage.h
@@ -183,8 +183,11 @@ struct PathSegmentDataStorage
 
     size_t prepareSamples(const bool useNEEMiWeights = false, const bool guideDirectLight = false, const bool rrAffectsDirectContribution = true)
     {
-        const float minPDF {0.1f};
+        // clamping thresholds to avoid generating extremly strong fireflies that 
+        // could mess-up the fitting of the distributions 
+        const float minPDF {0.01f};
         const openpgl::Vector3 maxThroughput {10.0f};
+
 #if defined(OPENPGL_PATHSEGMENT_STORAGE_USE_ARRAY)
         size_t numSegments = m_seg_idx+1;
 #else
