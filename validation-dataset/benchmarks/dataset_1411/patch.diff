From d5f708f8ebf2b3d801a50e778208245ebb59ff61 Mon Sep 17 00:00:00 2001
From: Tom Nixon <tom@tomn.co.uk>
Date: Wed, 14 Aug 2019 11:29:11 +0100
Subject: [PATCH] improve performance of parseHexValue

- use a static regex
- don't use a stringstream to parse
---
 src/detail/hex_values.cpp | 14 +++++---------
 1 file changed, 5 insertions(+), 9 deletions(-)

diff --git a/src/detail/hex_values.cpp b/src/detail/hex_values.cpp
index 0ec9e68b..0b4eb8b8 100644
--- a/src/detail/hex_values.cpp
+++ b/src/detail/hex_values.cpp
@@ -2,21 +2,17 @@
 #include <iomanip>
 #include <regex>
 #include <sstream>
+#include <string>
 
 namespace adm {
   namespace detail {
 
     unsigned int parseHexValue(const std::string& value,
                                unsigned int nmbOfChars) {
-      std::stringstream regexString;
-      regexString << "[0-9a-fA-F]{1," << nmbOfChars << "}";
-      const std::regex r(regexString.str());
-      if (std::regex_match(value, r)) {
-        unsigned int ret;
-        std::stringstream ss;
-        ss << std::hex << value;
-        ss >> ret;
-        return static_cast<unsigned int>(ret);
+      const static std::regex r("[0-9a-fA-F]+");
+
+      if (std::regex_match(value, r) && value.size() <= nmbOfChars) {
+        return static_cast<unsigned int>(std::stol(value, nullptr, 16));
       } else {
         std::stringstream errorString;
         errorString << "failed to convert hex value to int: " << value;
